\documentclass[a4paper, 10pt, oneside, DIV=9, chapterprefix=true, numbers=enddot, bibliography=totoc]{scrbook}
\usepackage{StyleEtaleI}
\usepackage{ShortcutsEtaleI}
\usepackage{halloweenmath}
\usetikzlibrary{shapes.geometric}
\usepackage{tikzducks}

\newcommand{\magic}{%
	\smash{\tikz[scale=0.125, baseline=-3]{%
		\fill (-0.65,0) -- (0.65,0) -- (0.65,-1.1) -- (-0.65, -1.1) -- cycle;%
		\fill (0,-1.1) ellipse (0.65 and 0.195);%
		\fill[white] (0,-0.15) ellipse (1 and 0.3);%
		\fill (0,0) ellipse (1 and 0.3);%
		\fill[white] (0,0) ellipse (0.6 and 0.18);%
		\draw[line width=1, line cap=round] (1.75,-0.25) -- (0.6,0.9);
		\draw[line width=0.375, white, line cap=round] (0.9,0.6) -- (0.6,0.9);
		\node[fill, scale=0.125, star, star point ratio=0.42, rotate=180] at (0.1,1) {};
		\node[fill, scale=0.25, star, star point ratio=0.42, rotate=180] at (-0.4,0.7) {};
		\node[fill, scale=0.25, star, star point ratio=0.42, rotate=180] at (-0.75,1.25) {};
		\node[fill, scale=0.2, star, star point ratio=0.42, rotate=180] at (-0.1,1.6) {};
	}}
}

\newcommand{\mysteriousduck}{%
	\smash{\tikz[baseline=(guenther-bill), scale=0.3]\duck[name=guenther, tshirt=white, grumpy, body=white, hat=black,sunglasses=black,  bill=black!25!white];}\hspace{-0.4em}
}

\subject{Lecture Notes for}
\title{Étale Cohomology I}
\author{{\normalsize Lecturer}\\
	Jens Franke}
\date{{\normalsize Notes typed by}\\
	Ferdinand Wagner}
\publishers{Winter Term 2019/20\\
University of Bonn}

\begin{document}
\frontmatter
\KOMAoption{chapterprefix}{false}
\maketitle
\noindent This text consists of notes on the lecture Advanced Topics in Algebraic Geometry (Étale Cohomology I), taught at the University of
Bonn by Professor Jens Franke in the winter term (Wintersemester) 2019/20.

Some changes and some additions have been made by the author. To distinguish them from the lecture's actual contents, they are labelled with an asterisk. So any \emph{Lemma}* or \emph{Remark}* or \emph{Proof}* that the reader might encounter are wholly the author's responsibility.\\[\thmsep]Please report errors, typos etc.\ through the \emph{Issues} feature of GitHub.


\tableofcontents
\listoftoc{lol}
\chapter{Preface}
\numpar*{Organizational stuff}As a result of a democratic decision in the preliminary meeting, the lecture will take place on Mondays from from 18:00 to 20:00 and on Fridays from 16:00 to 18:00, in the \enquote{Großer Hörsaal}.

Recommended prerequisites to this lecture are
\begin{temize}
	\item flat morphisms and faithfully flat descent,
	\item abelian varieties, in particular, the Jacobian of a curve.
\end{temize}
Nevertheless, Professor Franke promised to give a quick reminder on flat and étale morphisms in the first lecture. Moreover, typed lecture notes are available for Professor Franke's lecture on Jacobians of curves held in the winter term 2018/19 (see \cite{jacobians}). 

The goal of this lecture is to study the \emph{$\ell$-adic cohomology} of a scheme $X$, where $\ell\neq p$ is a prime different from the characteristic $p$ of $X$. These groups will be constructed as
\begin{align*}
	H_\et^i(X,\IZ_\ell)\coloneqq\lim_{n\geq 1}H^i(X_\et,\IZ/\ell^n\IZ)\,.
\end{align*}
Along the way, we will come across sheaves on the étale site, the relation between étale and Galois cohomology, cohomology of curves, and proper base change.

\numpar*{Author's note}
In these notes, the modern meaning of the word \emph{scheme} is used. That is, a scheme in these lecture notes is what Professor Franke would call a \emph{prescheme}, and what he would call a \emph{scheme} will be called a \emph{separated scheme} in here.

Also I will not follow Franke's numbering scheme\footnote{\ldots\ if not to say, numbering \emph{prescheme}.}, as I believe this document is easier to navigate if propositions/lemmas/etc.\ are numbered consecutively rather than independent of each other. 

\numpar*{Important note}
There will be no lecture next Friday ($1\ordinalst$ November), and the lecture next Monday ($4\ordinalth$ November) will take place in Seminarraum 0.011.


\mainmatter\KOMAoption{chapterprefix}{true}

\chapter{Motivation and Basic Definitions}
\section{Motivation}
\lecture[Weil cohomology theories: some motivation, some (counter-)examples; flatness, flat base change, faithfully flat descent.]{2019-10-18}
\numpar{Problem} For a scheme $X$, we would like to have cohomology groups $H^*(X,\IZ)$ with properties similar to the ones familiar from algebraic topology. For example, if $f\colon X\morphism X$ is a continuous map of a topological space into itself, then (under some sensible conditions) the \emph{Lefschetz trace formula} says
\begin{equation*}
	\#\left\{\text{fixed points of }f\text{, counted with multiplicity}\right\}=\sum_{i=0}^{\dim(X)}(-1)^i\Tr\left(f^ *\middle| H^i(X,\IQ)\right)\,.
\end{equation*}
Now assume that $X$ is some variety $X$ over $k=\IF_q$, where $q=p^n$, and $f=\Frob_q$ is the Frobenius on $X$. Then the fixed points of $f$ are precisely the $k$-valued points of $X$. As the \enquote{derivative} $\d f$ vanishes, $(\id{}-\d f)$ should be invertible, so all fixed points of $f$ ought to have multiplicity one (bear in mind that all of this is purely motivational and has no ambition of being a formal argument). Hence we could hope that
\begin{equation*}
	\# X(k)=\sum_{i=0}^{2\dim(X)}(-1)^i\Tr\big(f^*\big| H^i(X_{\ov{k}},\magic)\big)\,,
\end{equation*}
where $H^i(X_{\ov{k}},\magic)$ is a mysterious cohomology group of the base change of $X$ to an algebraic closure of $k$. Also the sum ranging up to $2\dim(X)$ accounts for the fact that the \enquote{cohomological dimension} of $X$ should be twice its Krull dimension, same as the topological dimension of a complex manifold is twice its $\IC$-dimension.

Such a mystery cohomology theory with sufficiently nice properties is called a \defemph{Weil cohomology theory}\footnote{In fact, one can formulate a series of axioms to properly define the notion of \defemph{Weil cohomology theory}, but we didn't do that in the lecture.}, named after André Weil, who noticed that such a cohomology theory would solve most of his conjectures on varieties over finite fields, that became famously known as the \emph{Weil conjectures}.

\begin{cntx}
A natural candidate for a Weil cohomology theory is \emph{de Rham cohomology}. For a variety $X$ over a field $k$ it is defined as 
\begin{equation*}
	H_\dR^*(X)\coloneqq H^*(X,\Omega_{X/k}^\bullet)\,,
\end{equation*}
i.e., as the (hyper-)cohomology of the de Rham complex $\Omega_{X/k}^\bullet$.	By de Rham's famous theorem, the de Rham cohomology of a real manifold coincides with its singular cohomology over $\IR$, so it makes sense to hope that $H_\dR^*(X)$ still works as a replacement of singular cohomology for varieties over an arbitrary field $k$. But on second glance, this can't be true: even if we are lucky and a Lefschetz-like equation holds for de Rham cohomology in characteristic $p >0$, then it would still only be a congruence modulo $p$, since the $H_\dR^*(X)$ are $\IF_p$-vector spaces in this case, so the traces take values in $\IF_p$ as well.
\end{cntx}
\begin{cntx}
It is also impossible to find a Weil cohomology with coefficients in $\IQ$, nor in $\IZ$, nor in $\IZ_p$ if we work in characteristic $p$. Professor Franke sketched a counterexample, which I'm trying my best to reproduce here (but it may well be I got it wrong---however, this won't be needed for the lecture). For a \emph{supersingular elliptic curve} $E$ the endomorphism ring $\End(E)$ can have the property that $D=\End(E)\otimes \IQ$ is a quaternion algebra over $\IQ$ with the properties that
\begin{align*}
	\inv_v(D)=\begin{cases}
		\frac{1}{2} & \text{if }v=p\text{ or }v=\infty\\
		0 & \text{else}
	\end{cases}
\end{align*}
However, if we had a Weil cohomology theory with coefficients in $\IQ$, then $H^0(E,\IQ)\oplus H^2(E,\IQ)$ would be a two-dimensional representation of $D$. But this can only be true if $D$ is split over $\IQ$, which can't be true as $\inv_v(D)=\frac12$ for $v\in\{p,\infty\}$.
\end{cntx}
\numpar{Solutions} The following approaches (might) lead to suitable Weil cohomology theories.
\begin{alphanumerate}
	\item Étale cohomology $H_\et^*(X,\IZ/\ell^n\IZ)$ for a prime $\ell\neq p$. This will lead to $\ell$-adic cohomology, which has coefficients in $\IZ_\ell$ resp.\ in $\IQ_\ell$. It can still be defined for $\ell=p$, but gives the wrong results in this case.
	\item Crystalline cohomology, with coefficients in the \emph{Witt ring} $W(k)$.
	\item Constructing a $\IC$-valued Weil cohomology theory seems hard. For example, there ought to be an anti-linear endomorphism $\sigma$ of $H^i(X,\IC)$ that satisfies $\sigma^2=(-1)^i$. Still some people (e.g.\ Connes) try this. See for example Peter Scholze's \href{http://www.math.uni-bonn.de/people/scholze/Rio.pdf}{survey} at the ICM 2018 in Rio de Janeiro.
\end{alphanumerate}
In this lecture we will stick with approach \itememph{a}. Grothendieck's construction of étale cohomology is to relax the usual notion of a \emph{topology} on a topological space. In a \emph{Grothendieck topology}, the \enquote{open subsets} no longer need to form a partially ordered set, but rather more general categories are allowed. Then étale cohomology can be introduced as sheaf cohomology for such a generalized topology.

\begin{exm}
	Here is an example why we would want a topology that is finer than the usual Zariski topology. On a complex manifold $X$ with its sheaf $\Oo_X$ of $C^\infty$-functions we have the short exact sequence
	\begin{equation*}
		0\morphism 2\pi\mathrm{i}\IZ\morphism\Oo_X\morphism[\exp]\Oo_X^\times\morphism 0\,.
	\end{equation*}
	For a scheme $X$, there is a similar sequence
	\begin{equation*}
		0\morphism\mu_n\morphism\Oo_X^\times\morphism[(-)^n]\Oo_X^\times\morphism 0\,,
	\end{equation*}
	where $\mu_n$ is the sheaf of $n\ordinalth$ roots of unity on $X$. This has but one flaw: it is usually not exact. Indeed, for $(-)^n\colon \Oo_X^\times\morphism\Oo_X^\times$ to be an epimorphism, we would have to take \enquote{local $n\ordinalth$ roots} in $\Oo_X^\times$, which is usually not possible. Instead, taking a \enquote{local $n\ordinalth$ root} corresponds to some quasi-finite morphism $X'\morphism X$, which need not be an open immersion in the Zariski topology---that's the point! \emph{But if} morphisms like $X'\morphism X$ would count as a open subsets in some topology, then the above sequence might well be exact in that topology!
	
	In the étale topology, \emph{étale morphisms} (i.e.\ those that are flat and unramified) play the role of open subsets. It will turn out that the above sequence is exact as a sequence of étale sheaves. So after all it should come as no surprise that every étale morphism is also quasi-finite.
\end{exm}


\section{Reminder on Flat Morphisms}
This section is really just a crash course. Professor Franke gave a much more detailed introduction to flat morphisms in his Jacobians of curves lecture, so be sure to have a look at \cite[Chapter~2]{jacobians}.
\begin{defprop}
	An $A$-module $M$ is \defemph{flat} if $-\otimes_AM\colon \cat{Mod}_A\morphism\cat{Mod}_A$ is an exact functor, or equivalently, if $\Tor_i^A(-,M)=0$ for all $i>0$.
\end{defprop}
\begin{defprop}
	Let $f\colon X\morphism Y$ a morphism of schemes and $\Ff$ a quasi-coherent $\Oo_X$-module. Then $\Ff$ is called \defemph{flat over $\Oo_Y$} if the following equivalent conditions hold.
	\begin{alphanumerate}
		\item For all affine open subsets $U\subseteq X$, $V\subseteq Y$ such that $f(U)\subseteq V$, $\Global(U,\Ff)$ is a flat $\Global(V,\Oo_Y)$-module.
		\item It is possible to cover $X$ with affine opens $U$ and $Y$ with affine opens $V$ such that the above holds.
		\item If $x\in X$ and $y\coloneqq f(x)$, then $\Mm_x$ is a flat $\Oo_{Y,y}$-module.
	\end{alphanumerate}
	In the case where $\Oo_X$ itself is flat over $\Oo_Y$, the morphism $f$ is called a \defemph{flat morphism}.
\end{defprop}
\begin{rem}
	\begin{alphanumerate}
		\item The property of being a flat morphism is local on source and target and stable under composition and base-change. That is, if $f\colon X\morphism Y$ is flat and $Y'\morphism Y$ is any morphism, then the base change 
		\begin{align*}
			f'\colon X\times_YY'\morphism Y'
		\end{align*}
		is flat again.
		\item When $f$ is flat, the pullback functor $f^*\colon \cat{Mod}_{\Oo_X}\morphism\cat{Mod}_{\Oo_Y}$ is exact.
	\end{alphanumerate}
\end{rem}
\begin{prop}[Flat base change]\label{prop:FlatBaseChange}
	Consider the following pullback diagram of morphisms of schemes
	\begin{equation*}
		\begin{tikzcd}
			X'\rar["f'"]\dar["g'", swap]\drar[pullback] & Y'\dar["g"]\\
			X\rar["f"] & Y
		\end{tikzcd}\,,
	\end{equation*}
	where $f$ is quasi-compact separated and $g$ is flat. Let $\Ff$ be a quasi-coherent $\Oo_X$-module.
	\begin{alphanumerate}
		\item Assume $Y=\Spec A$ and $Y=\Spec A'$ are affine (so $A'$ is a flat $A$-algebra). Then there is a natural isomorphism
		\begin{equation*}
			H^i(X,\Ff)\otimes_AA'\isomorphism H^i(X',g'^*\Ff) \quad\text{for all }i\geq 0\,.
		\end{equation*}
		\item For arbitrary $Y$ and $Y'$ there is a natural isomorphism
		\begin{equation*}
			g^*R^if_*\Ff\isomorphism R^if'_*(g'^*\Ff)\quad\text{for all }i\geq 0\,.
		\end{equation*}
	\end{alphanumerate}
\end{prop}
\begin{proof}[Sketch of a proof]
	Note that the cohomology of quasi-coherent sheaves on quasi-compact separated schemes can be computed as the \v Cech cohomology of an affine open cover. This easily shows \itememph{a}. Part~\itememph{b} can be checked locally, hence it can be reduced to \itememph{a}. For more details, check out \cite[Subsection~2.1.1]{jacobians}.
\end{proof}
\begin{rem*}
	\cref{prop:FlatBaseChange} already holds if $f$ is quasi-compact and quasi-separated (but in this case \v Cech cohomology no longer computes sheaf cohomology). To prove this, one uses the \v Cech-to-derived spectral sequence to reduce the quasi-separated case to the separated case (check out \cite[\stackstag{02KH}]{stacks-project} for details).
\end{rem*}
\begin{defi}
	A morphism $f\colon X\morphism Y$ is called \emph{faithfully flat} if it is flat and surjective (as a map on underlying sets).
\end{defi}
Before we give the next definition, let's fix the following notation: we denote by
\begin{align*}
	p_i\colon X\times_YX&\morphism X\,,\\
	\quad q_i\colon X\times_YX\times_YX&\morphism X\,,\\
	\quad q_{k,l}\colon X\times_YX\times_YX&\morphism X\times_YX
\end{align*}
the canonical projections to the $i\ordinalth$ factor, to the $j\ordinalth$ factor, and to the $k\ordinalth$ and $l\ordinalth$ factor respectively. Here $i\in \{1,2\}$ and $j,k,l\in\{1,2,3\}$.
\begin{defi}\label{def:descent}
	Let $f\colon X\morphism Y$ be a morphism of schemes. A \defemph{descent datum} for $f$ is a pair $(\Ff,\mu)$, where $\Ff$ is a quasi-coherent $\Oo_X$-module and $\mu$ is an isomorphism
	\begin{equation*}
		\mu\colon p_1^*\Ff\isomorphism p_2^*\Ff\,,
	\end{equation*}
	such that the following diagram commutes:
	\begin{equation}\label{diag:cocycle}
		\begin{tikzcd}
			q_1^*\Ff \drar[iso,"q_{1,3}^*(\mu)"{swap}]\ar[rr,iso,"q_{1,2}^*(\mu)"{swap}]& & q_2^*\Ff\dlar[iso,"q_{2,3}^*(\mu)"]\\
			& q_3^*\Ff &
		\end{tikzcd}\,.
	\end{equation}
	A \defemph{morphism of descent data} $\phi\colon (\Ff,\mu)\morphism(\Ff',\mu')$ is a morphism of $\Oo_X$-modules $\phi\colon \Ff\morphism\Ff'$ such that the diagram
	\begin{equation*}
		\begin{tikzcd}
			p_1^*\Ff\rar[iso,"\mu"{swap}]\dar["p_1^*(\phi)"{swap}] & p_2^*\Ff\dar["p_2^*(\phi)"]\\
			p_1^*\Ff'\rar[iso,"\mu'"{swap}]& p_2^*\Ff'
		\end{tikzcd}
	\end{equation*}
	commutes. One thus obtains a \defemph{category of descent data} for $f$, which is denoted $\cat{Desc}_{X/Y}$.
\end{defi}
\begin{rem*}
	You might have seen a different definition of descent data, which, instead of a single morphism $f\colon X\morphism Y$ and a single $\Ff$, considers a family of morphisms $\{X_i\morphism Y\}_{i\in I}$ and for each $i\in I$ an $\Oo_{X_i}$-module $\Ff_i$. For example, this is the definition used in \cite[\stackstag{023A}]{stacks-project}. On taking $X=\coprod_{i\in I}X_i$ this definition becomes equivalent to \cref{def:descent}. Under this equivalence, \cref{diag:cocycle} becomes the infamous \emph{cocycle condition}.
\end{rem*}
\begin{rem}\label{rem:descentFunctor}
	\begin{alphanumerate}
		\item The notion of a \emph{descent datum} can be defined in a purely abstract way, as soon as one has suitable \enquote{pullback functors} $f^*$. The abstract framework to do are \defemph{fibred categories}. See \cite[Exposé~VI]{sga1}.
		\item There is a functor $f^*\colon \cat{QCoh}_{\Oo_Y}\morphism\cat{Desc}_{X/Y}$ that assigns to a quasi-coherent $\Oo_Y$-module $\Gg$ the pair $(f^*\Gg,\mu_\Gg)$, where $\mu_\Gg$ is the canonical isomorphism
		\begin{equation*}
			\mu_\Gg\colon p_1^*f^*\Gg\isomorphism(fp_1)^*\Gg=(fp_2)^*\isomorphism p_2^*f^*\Gg\,.
		\end{equation*}
	\end{alphanumerate}
\end{rem}
\begin{prop}
	If $f\colon X\morphism Y$ is faithfully flat and quasi-compact (which we abbreviate as \enquote{fpqc} in the following, from French \enquote{fidélement plat et quasi-compact}), then the functor $f^*\colon \cat{QCoh}_{\Oo_Y}\morphism \cat{Desc}_{X/Y}$ from \cref{rem:descentFunctor}\itememph{b} is an equivalence of categories.
\end{prop}
\begin{proof}[Sketch of a proof]
	The proof consists of two essentially independent steps and a third step that combines the first two. Step~1 is to prove the assertion under the assumption that $f$ has a section $\sigma\colon Y\morphism X$ (this is pretty much straightforward). Step~2 is to construct a right-adjoint $R\colon \cat{Desc}_{X/Y}\morphism \cat{QCoh}_{\Oo_Y}$ of $f^*$.\footnote{Professor Franke emphasizes that this should be in every mathematicians bag of tricks: if you are to show that some functor is an equivalence, look for a right- or left-adjoint!}
	
	In Step~3 we show that $R$ (and thus $f^*$) is an equivalence of categories. This boils down to checking that unit and counit of the adjunction are natural isomorphisms. However, a map being an isomorphism can be checked after faithfully flat base change. Base-changing by $f$ itself, we end up in a situation where a section $\sigma$ exists---the diagonal $\Delta\colon X\morphism X\times_YX$. So Step~1 can be applied, which concludes the proof. For more details check out \cite[Theorem~7]{jacobians}.
\end{proof}
\begin{cor}\label{cor:fpqcEqualizer}
	\lecture[Properties of fpqc morphisms; Grothendieck topologies.]{2019-10-21}
	If $f\colon X\morphism Y$ is fpqc, then for all open subset $U\subseteq Y$ we have a natural isomorphism
	\begin{equation*}
		\Global(U,\Oo_Y)\isomorphism\left\{\lambda\in \Global(f^{-1}(U),\Oo_X)\st p_1^*\lambda =p_2^*\lambda\text{ in }\Global(p^{-1}(U),\Oo_{X\times_YX})\right\}\,.
	\end{equation*}
	Here, $p\colon X\times_YX\morphism Y$ denotes the natural morphism (and $p=fp_1=fp_2$).
\end{cor}
At this point, Professor Franke recalls the notion of mono-/epimorphism and their \defemph{effective} variants. We refer to \cite[Appendix~A.1]{alggeo2} for the relevant definitions and to \cite[Subsection~1.3.1]{alggeo1} for a construction of equalizers in the category of schemes.
\begin{prop}\label{prop:fpqcEffectiveEpi}
	An fpqc morphism is an effective epimorphism in the category of schemes.
\end{prop}
\begin{proof}[Sketch of a proof]
	One first shows that $Y$ carries the quotient topology with respect to $X$. To prove this, use \cite[Exposé~VIII Théorème~4.1]{sga1}. Alternatively you can look up the proof in \cite[Proposition~2.5.3]{jacobians}. This shows the topological part of the assertion. For the algebraic part, use \cref{cor:fpqcEqualizer}.
	
	If you are looking for a more detailed proof than this extremely brief sketch, check out \cite[Corollary~2.6.2]{jacobians}.
\end{proof}
\begin{prop}\label{prop:ppfOpen}
	If $f\colon X\morphism Y$ is flat a morphism of locally finite type between locally noetherian schemes, then $f$ is an open map on underlying topological spaces.
\end{prop}
\begin{proof*}
	See \cite[Corollary~2.5.1]{jacobians}.
\end{proof*}
\begin{rem*}
	One can generalize \cref{prop:ppfOpen} to flat morphisms of \emph{locally finite presentation} between arbitrary (i.e.\ not necessarily locally noetherian) schemes. The key idea in the proof is an ingenious trick that reduces
	everything to the noetherian case. You can find a very nice exposition of this in Akhil Mathews
	blog, see \url{https://amathew.wordpress.com/2010/12/26/}!
\end{rem*}

\section{Grothendieck Topologies, the fpqc Topology, and related ones}
You might have already seen Grothendieck topologies defined via \defemph{covering families}. However, this a priori only gives a Grothendieck \emph{pre}topology, as one has to pass to equivalence classes afterwards. Thus, Professor Franke prefers the later approach via \defemph{sieves} (which he attributes to Giraud). Of course, both approaches are equivalent.
\begin{defi}
	Let $\Cc$ be a category. A \defemph{sieve} over an object $x\in \Cc$ is a class $\Ss$ of morphisms $u\morphism x$ such that whenever $(u\morphism x)\in \Ss$, then also $(v\morphism u\morphism x)\in\Ss$ for all $(v\morphism u)\in\Hom_\Cc(x,y)$.
\end{defi}
\begin{exm}
	Let $\Cc$ be the partially ordered set of open subsets of a topological space $X$, and $\Uu=\{U_i\}_{i\in I}$ be any family of open subsets (not necessarily covering $X$). Then
	\begin{equation*}
		\Ss=\left\{V\subseteq X\st V\text{ is open and there exists an }i\in I\text{ such that }V\subseteq U_i\right\}
	\end{equation*}
	is a sieve over $X\in \Cc$.
\end{exm}
\begin{defi}\label{def:GrothendieckTopo}
	A \defemph{Grothendieck topology} on a category $\Cc$ is given by specifying a collection $ C_x$ of sieves over $x$ for all $x\in \Cc$, called the \defemph{covering sieves}, which are subject to the following conditions.
	\begin{alphanumerate}
		\item The all-sieve (containing all morphisms $u\morphism x$) is a covering sieve of $x$.
		\item If $p\colon y\morphism x$ is a morphism in $\Cc$ and $\Ss\in C_x$ a covering sieve of $x$, then $p^*\Ss\in C_y$ is a covering sieve of $y$. Here, we define
		\begin{equation*}
			p^*\Ss=\left\{u\to y\st (u\to y\morphism[p]x)\in \Ss\right\}\,.
		\end{equation*}
		\item Let $\Ss$, $\Tt$ be sieves over $x$ such that $\Ss\in  C_x$. If for all $(p\colon y\morphism x)\in \Ss$ we have $p^*\Tt\in C_y$, then also $\Tt\in C_x$.
	\end{alphanumerate}
	A category $\Cc$ together with a fixed Grothendieck topology is called a \defemph{site}.
\end{defi}
\begin{rem}
	\begin{alphanumerate}
		\item One can interpret \cref{def:GrothendieckTopo}\itememph{c} as saying that being a covering is a local property (and can thus be tested on another covering).
		\item If $\Tt\in C_x$ and $\Ss\supseteq \Tt$, then also $\Ss\in C_x$ (as one would expect that if a subsieve of $\Ss$ is already sufficient to \enquote{cover} the element $x$, then a fortiori the same is true for the whole sieve $\Ss$). Indeed, the condition in \cref{def:GrothendieckTopo}\itememph{c} is then trivially satisfied, because if $(p\colon y\morphism x)\in \Tt$, then $p^*\Ss\supseteq p^*\Tt$. However, the right-hand side is the all-sieve in this case, hence so is the left-hand side.
	\end{alphanumerate}
\end{rem}
\begin{exm}
	Let $\Cc$ be again the partially ordered set of open subsets of a topological space $X$. Define $\Ss\in C_U$ iff $U=\bigcup_{(V\subseteq U)\in\Ss}V$. Then this defines a Grothendieck topology on the category $\Cc$.
\end{exm}
\begin{con}
	Let $S$ be a scheme. We make the category $\cat{Sch}/S$ of schemes over $S$ into a site $(\cat{Sch}/S)_\Zar$ by defining a Grothendieck topology as follows: A sieve $\Ss$ over some $S$-scheme $X$ is a covering sieve iff there is a Zariski-open covering $X=\bigcup_{i\in I}U_i$ such that all morphisms $Y\morphism X$ that factor over some $U_i\monomorphism X$ belong to $\Ss$.
\end{con}
The next thing to do is to introduce the fpqc topology and the fppf topology on $\cat{Sch}/S$, and then finally the étale topology. But before we do this, we prove the very abstract and technical \cref{prop:technicalAF}, which in the end will save us some work in proving that certain equivalent descriptions of our topologies are indeed equivalent.

\begin{rem*}\label{rem*:clarificationsForTechnicalAF}
	Before we dive into the horrible technical nightmare of \cref{prop:technicalAF}, let us motivate some of the things that happen there. First of all, the three topologies we are going to look at are all somehow generated by a certain class of morphisms: the fpqc morphisms, the fppf morphisms, and the étale morphisms respectively. This role is played by $\Cc$ in \cref{prop:technicalAF}. In the first two cases, $\Cc_\fpqc$ and $\Cc_\fppf$ are precisely the classes of fpqc and fppf morphisms. For the étale topology, we would take $\Cc_\et$ to be the class of étale and surjective morphisms.
	
	Second, our topologies are, of course, generated by sieves. This is what $\Ss$ stands for in \cref{prop:technicalAF}. The purpose of said proposition is to establish two equivalent characterizations of these sieves---essentially, we will show that everything can be chosen affine if we wish to.
	
	Third, it might become reasonable to define our topology only on a nice subcategory of $\cat{Sch}/S$: for example, on the full subcategory of locally noetherian $S$-schemes. However, this might get us into trouble. The problem is that if we use \cref{def:GrothendieckTopo}\itememph{b} to its full potential, then it suddenly spawns fibre products. But fibre products need not preserve noetherianness. For example, $\Spec \IC$ and $\Spec \IQ$ are perfectly fine noetherian schemes, but $\Spec \IC\times_{\Spec \IQ}\Spec \IC\cong \Spec (\IC\otimes_\IQ\IC)$ is a non-noetherian abomination. That's where the property $\Pp$ comes in (and in particular, that's why we need $\Pp$ to be preserved under morphisms in $\Cc$). It turns out that it's possible to restrict the étale and fppf topology to the full subcategory of locally noetherian $S$-schemes, so in this case $\Pp_\et$ and $\Pp_\fppf$ could be the property of being locally noetherian. In the fpqc case however, such a restriction is impossible. So $\Pp_\fpqc$ will necessarily be the empty property (that is satisfied by every scheme) in this case. Of course, $\Pp_\et$ and $\Pp_\fppf$ can also be chosen to be the empty property.
\end{rem*}
\begin{prop}\label{prop:technicalAF}
	Let $S$ be a scheme and $\Cc$ a class of quasi-compact morphisms of $S$-schemes, which has the following properties.
	\begin{alphanumerate}
		\item $\Cc$ is closed under composition, finite coproducts, and base-change.
		\item If $U=\bigcup_{i=1}^nU_i$ is an affine open cover of an affine\footnote{This means that $U$ is affine, and an $S$-scheme, and \emph{not} that $U\morphism S$ is an affine morphism.} scheme $U$ over $S$, then the canonical morphism $\coprod_{i=1}^nU_i\morphism U$ is an element of $\Cc$.\footnote{Note that in the lecture we also had the requirement that $\id_U$ is an element of $\Cc$. However, this trivially follows from \itememph{b}.}
	\end{alphanumerate}
	Now let $\Pp$ be a local property of $S$-schemes, such that if $X'\morphism X$ is a morphism in $\Cc$ and $X$ has property $\Pp$, then $X'$ has $\Pp$ as well.\footnote{In the lecture we required $\Pp$ to be \enquote{stable under base change \ldots}, but didn't define what this was supposed to mean for a property of schemes (rather than morphisms). This is (at least equivalent to) what Franke had in mind.} Let $(\cat{Sch}/S)^\Pp\subseteq \cat{Sch}/S$ be the full subcategory of all objects with $\Pp$. Then for an object $X\in(\cat{Sch}/S)^\Pp$ and any sieve $\Ss$ over $X$, the following conditions on $\Ss$ are equivalent.
	\begin{numerate}
		\item There are an open cover $X=\bigcup_{i\in I}U_i$, together with finite sets $J_i$ for all $i\in I$, and morphisms $U_{i,j}\morphism U_i$ for all $j\in J_i$, such that all $U_{i,j}$ satisfy $\Pp$, the coproduct $\coprod_{j\in J_i}U_{i,j}\morphism U_i$ is in $\Cc$ for all $i\in I$, and all compositions $U_{i,j}\morphism U_i\morphism X$ are in $\Ss$.
		\item The same as \itememph{1}, but now all $U_i$ and $U_{i,j}$ are required to be affine.
	\end{numerate}
	Moreover, these sieves define a Grothendieck topology on $(\cat{Sch}/S)^\Pp$.
\end{prop}
\begin{proof}
	\lecture[The fpqc and the fppf topology; sheaves on sites.]{2019-10-25}It's clear that \itememph{2} implies \itememph{1}. For the converse we basically need the observations that quasi-compact schemes admit finite affine open covers and that affine schemes are quasi-compact, together with the fact that all morphisms from $\Cc$ are quasi-compact by assumption. However, writing this up is quite a pain, so we leave it as an exercise.
	
	We are left to check the conditions for a Grothendieck topology on $(\cat{Sch}/S)^\Pp$. To see that the all-sieve is covering, take any affine open cover $X=\bigcup_{i\in I}U_i$, $J_i=\{i\}$ for all $i$ and $U_{i,i}=U_i$. Then $\bigcup_{j\in J_i}U_{i,j}\morphism U_i$ is the identity on $U_i$, which is in $\Cc$ by \itememph{b}. Also $U_{i,i}\morphism U_i\morphism X$ is obviously part of the all-sieve. This shows that the all-sieve is covering.
	
	Now let $\Ss$ be a sieve on $X$ satisfying the equivalent properties \itememph{1}, \itememph{2}. Let $p\colon Y\morphism X$ be any morphism in $(\cat{Sch}/S)^\Pp$. We need to show that $p^*\Ss$ satisfies the equivalent properties as well. To this end, let $X=\bigcup_{i\in I}U_i$, $J_i$ and $U_{i,j}$ for all $i\in I$, $j\in J_i$ witness the property \itememph{2} for $\Ss$. Now consider
	\begin{equation*}
		V_i=Y\times_XU_i\quad\text{and}\quad V_{i,j}=Y\times_XU_{i,j}\,.
	\end{equation*}
	Then the morphism $\coprod_{j\in J_i}V_{i,j}\morphism V_i$ is in $\Cc$ because it is a base change of $\coprod_{j\in J_i}U_{i,j}\morphism U_i$, which is in $\Cc$, and $\Cc$ is stable under base change by \itememph{a}. Moreover, the $V_{i,j}$ all satisfy $\Pp$. Indeed, since $\Pp$ is local, it suffices to show that $\coprod_{j\in J_i}V_{i,j}$ has $\Pp$, and since $\coprod_{j\in J_i}V_{i,j}\morphism V_i$ is in $\Cc$, it suffices to show that $V_i$ has $\Pp$ (by our assumption on $\Pp$ and $\Cc$). However, $V_i$ is an open subset of $Y$, which has $\Pp$, so $V_i$ has $\Pp$ as well since $\Pp$ is local. It remains to see $(V_{i,j}\morphism Y)\in p^*\Ss$. But the $V_{i,j}$ fit into pullback diagrams
	\begin{equation*}
		\begin{tikzcd}
			V_{i,j} \rar\dar\drar[pullback] & Y\dar["p"]\\
			U_{i,j}\rar & X
		\end{tikzcd}\,,
	\end{equation*}
	so $V_{i,j}\morphism Y\morphism X$ factors over a morphism in $\Ss$. Thus $(V_{i,j}\morphism Y)\in p^*\Ss$ holds by definition.
	
	Last but not least we prove locality of covering sieves. Let $\Ss\in C_X$ be a covering sieve of $X$ and let $U_i$, $J_i$ and $U_{i,j}$ witness \itememph{2} for $\Ss$. Let $\Tt$ be another sieve over $X$ such that $p^*\Tt\in C_Y$ for any $(p\colon Y\morphism X)\in \Ss$. In particular, we can apply this to $(\sigma_{i,j}\colon U_{i,j}\morphism X)\in\Ss$. Thus, there are an affine open cover $U_{i,j}=\bigcup_{k\in K_{i,j}}V_{i,j,k}$ and finite sets $L_{i,j,k}$ for all $k\in K_{i,j}$ together with morphisms $V_{i,j,k,l}\morphism V_{i,j,k}$, such that $\coprod_{l\in L_{i,j,k}}V_{i,j,k,l}\morphism V_{i,j,k}$ is in $\Cc$, all $V_{i,j,k,l}$ have $\Pp$, and $V_{i,j,k,l}\morphism U_{i,j}$ is an element of $\sigma_{i,j}^*\Tt$ (up to now that was just unraveling of definitions). Since the $U_{i,j}$ are affine, we may assume that the $K_{i,j}$ are finite sets as well. Thus
	\begin{equation*}
		\coprod_{j\in J_i}\coprod_{k\in K_{i,j}}\coprod_{l\in L_{i,j,k}}V_{i,j,k,l}\morphism U_i
	\end{equation*}
	is a finite coproduct. This morphism is also in $\Cc$, since it can be factored as
	\begin{equation*}
		\coprod_{j\in J_i}\coprod_{k\in K_{i,j}}\coprod_{l\in L_{i,j,k}}V_{i,j,k,l}\morphism \coprod_{j\in J_i}\coprod_{k\in K_{i,j}}V_{i,j,k}\morphism \coprod_{j\in J_i}U_{i,j}\morphism U_i\,.
	\end{equation*}
	The left-most arrow is in $\Cc$ since it is a finite coproduct of $\coprod_{l\in L_{i,j,k,l}}V_{i,j,k,l}\morphism V_{i,j,k}$, which is in $\Cc$ by assumption, and $\Cc$ is stable under finite coproducts by \itememph{a}. The middle arrow is in $\Cc$, because it is a finite coproduct of $\coprod_{k\in K_{i,j}}V_{i,j,k}\morphism U_{i,j}$, which are in $\Cc$ by \itememph{b}. Finally, the right-most arrow is in $\Cc$ by assumption. 
	
	This finally shows that $\Tt$ is a covering sieve of $X$. Thus, we indeed get a Grothendieck topology of $(\cat{Sch}/S)^\Pp$.
\end{proof}
\begin{rem}
	This can be found in the $4\ordinalth$ issue of the \emph{Séminaire de Géométrie Algébrique du Bois Marie (SGA)} publications. Professor Franke outlines the contents of the various SGAs.
	\begin{numerate}
		\item[{\cite{sga1}}] Flat descent, the étale fundamental group.
		\item[{\cite{sga2}}] Local cohomology.
		\item[{[SGA$_4$]}] This consists of three parts: in \cite{sga4.1}, \cite{sga4.2} the general theory of topoi and the étal topos of a scheme are introduced. The third part \cite{sga4.3} proves hard theorems in étale cohomology.
		\item[{\cite{sga4.5}}] This is a very good reference besides \cite{milne} and \cite{kiehlfreitag}. Especially the \enquote{Arcata} part is very recommendable.
		\item[{\cite{sga5}}] $\ell$-adic cohomology.
	\end{numerate}
	You should be able to read French though (\emph{author's note}: personal experience shows that Google Translate is usually sufficient).
\end{rem}
\begin{defi}
	\begin{alphanumerate}
		\item Let $\Pp_\fpqc$ be the trivial property and $\Cc_\fpqc$ be the class of fpqc morphisms. Then the Grothedieck topology constructed in \cref{prop:technicalAF} is called the \defemph{fpqc topology}. The corresponding site $(\cat{Sch}/S)_\fpqc$ is called the \defemph{big fpqc site}.
		\item Let $\Pp_\fppf$ be either the trivial property or $\Pp_\fppf=\left\{\text{locally noetherian schemes}\right\}$. Let $\Cc_\fppf$ be the class of faithfully flat and finitely presented morphisms. Then the Grothendieck topology from \cref{prop:technicalAF} is called the \defemph{fppf topology}. The corresponding site $(\cat{Sch}/S)_\fppf$ is called the \defemph{big fppf site}.
	\end{alphanumerate}
\end{defi}
\begin{rem}
	\begin{alphanumerate}
		\item We cannot choose $\Pp_\fpqc=\left\{\text{locally noetherian schemes}\right\}$. For example, take the counterexample from \cref{rem*:clarificationsForTechnicalAF}: $\Spec\IC\morphism \Spec\IQ$ is an fpqc morphism, hence so is its base change $\Spec(\IC\otimes_\IQ\IC)\morphism \Spec\IC$. However, $\IC\otimes_\IQ\IC$ is non-noetherian. 
		
		To see this, let $I$ be the kernel of the multiplication map $\IC\otimes_\IQ\IC\morphism \IC$. If $\IC\otimes_\IQ\IC$ was noetherian, then $I/I^2$ would be a finitely generated module over $(\IC\otimes_\IQ\IC)/I\cong \IC$. However, $I/I^2\cong \Omega_{\IC/\IQ}$, whose $\IC$-dimension is the cardinality of the continuum.
		\item However, this works for the fppf topology since being locally noetherian is preserved under finitely presented morphisms. The abbreviation fppf comes from French \enquote{fidélement plat et de présentation finie}. For fppf covering sieves, Professor Franke briefly mentioned some equivalent characterizations, which we summarize in the following lemma. 
	\end{alphanumerate}
\end{rem}
\begin{lem*}
	Let $X$ be a scheme over $S$ and let $\Ss$ be a sieve over $X$. Then the following are equivalent:
	\begin{alphanumerate}
		\item $\Ss$ is an fppf-covering sieve.
		\item We find an affine open cover $X=\bigcup_{i\in I}U_i$ and fppf morphisms $V_i\morphism U_i$ such that $(V_i\morphism U_i\morphism X)\in \Ss$ for all $i\in I$.
		\item Same as \itememph{b}, but the $V_i\morphism U_i$ are quasi-finite in addition to being fppf.
	\end{alphanumerate}
\end{lem*}
\begin{proof}[Sketch of a proof\textup{*}]
	Clearly \itememph{c} implies \itememph{b} implies \itememph{a}. To see \itememph{a} $\Rightarrow$ \itememph{b}, the crucial thing to note is that if $X=\bigcup_{i\in I}U_i$, $K_i$, and $U_{i,j}$ are as in \cref{prop:technicalAF}\itememph{2}, then the $U_{i,j}\morphism U_i$ are open maps by \cref{prop:ppfOpen}. The rest is purely formal.
	
	However, \itememph{b} $\Rightarrow$ \itememph{c} is not so easy to see. This needs Cohen--Macaulay properties and we refer to \cite[\stackstag{056X}]{stacks-project}.
\end{proof}
Having defined Grothendieck topologies and seen some examples, the next step is to define sheaves on sites.
\begin{defi}\label{def:sheaf}
	Let $\Cc$ be an arbitrary category.
	\begin{alphanumerate}
		\item A \defemph{presheaf} on $\Cc$ (with values in sets, groups, rings, \ldots) is a functor from $\Cc^\op$ to the categories of groups, sets, rings, \ldots.
		\item Suppose $\Cc$ is equipped with a Grothendieck topology defined by collections $C_x$ of covering sieves for all $x\in \Cc$. Then a presheaf $\Ff$ is called a \defemph{sheaf} if for all $x\in \Cc$ and all $\Ss\in C_x$ the following condition holds: the morphisms $v^*\colon \Ff(x)\morphism\Ff(u)$ for $(v\colon u\morphism x)\in\Ss$ induce a bijection
		\begin{equation*}
			\Ff(x)\isomorphism \lim_{v\in\Ss}\Ff(u)
		\end{equation*}
	\end{alphanumerate}
\end{defi}
\begin{rem}
	\begin{alphanumerate}
		\item If only injectivity of the above map is assumed, the presheaf $\Ff$ is called \defemph{separated}.
		\item If $\Ff$ has values in sets, groups, rings, \ldots, then the limit on the right-hand side of \cref{def:sheaf}\itememph{b} can be explicitly described as follows:
		\begin{equation*}
			\lim_{v\in \Ss}\Ff(u)=\left\{(f_v)_{v\in \Ss}\in\prod_{v\in\Ss}\Ff(u)\st \begin{tabular}{c}
				if $(v\colon u\rightarrow x),(v'\colon u'\rightarrow x)\in\Ss$ and\\
				 $\pi\colon u\rightarrow u'$
				 is any morphism such\\
				 that $v=v'\pi$, then $f_v=\pi^*f_{v'}$
			\end{tabular}\right\}
		\end{equation*}
	\end{alphanumerate}
\end{rem}
\begin{prop}\label{prop:fpqcSheaf}
	For the Grothendieck topologies of \cref{prop:technicalAF}, a presheaf $\Ff$ on $(\cat{Sch}/S)^\Pp$ is a sheaf iff its restriction to Zariski-open subsets of any $X\in (\cat{Sch}/S)^\Pp$ is an ordinary sheaf on $X$, and for every morphism $(X'\morphism X)\in\Cc$ the sequence
	\begin{equation*}
		\Ff(X)\morphism\Ff(X')\doublemorphism[p_1^*][p_2^*]\Ff(X'\times_XX')
	\end{equation*}
	establishes the left arrow as an equalizer of the double arrow on the right. Here, we denote by $p_1,p_2\colon X'\times_XX'\morphism X'$ the canonical projections.
\end{prop}
\begin{proof}[Sketch of a proof*]
	Let's first assume that $\Ff$ is a sheaf. Since every sieve over $X$ generated by a Zariski-open cover is indeed a covering sieve (since the condition from \cref{prop:technicalAF}\itememph{2} is obviously satisfied), we see that $\Ff$ restricts to a Zariski-sheaf on $X$. Moreover, if the morphism $X'\morphism X$ is in $\Cc$, then the sieve $\Ss$ of all morphisms $v\colon U\morphism X$ that factor through $X'$ is a covering sieve. Indeed, the condition from \cref{prop:technicalAF}\itememph{1} is clearly satisfied. Hence
	\begin{equation*}
		\Ff(X)\isomorphism\lim_{v\in \Ss}\Ff(U)\,.
	\end{equation*}
	Now every $\Ff(X)\morphism \Ff(U)$ factors through $\Ff(X)\morphism\Ff(X')$. Moreover, if $U\morphism X$ factors in two different ways through $X'$, then this induces a unique map $U\morphism X'\times_XX'$, and thus a map $\Ff(X'\times_XX')\morphism\Ff(U)$. If you think about it, this shows that
	\begin{equation*}
		\Ff(X')\doublemorphism[p_1^*][p_2^*]\Ff(X'\times_XX')
	\end{equation*}
	is a coinitial subdiagram of the diagram given by $\{\Ff(U)\}_{v\in\Ss}$. Hence the limit over the latter diagram is the same as the equalizer of $p_1^*$ and $p_2^*$, so $\Ff(X)$ mapping isomorphically to that limit means that $\Ff(X)$ is said equalizer, as claimed.
	
	Now for the converse. Assume that $\Ff$ is a presheaf with the required property and let $\Ss$ be a covering sieve over $X$. Let $X=\bigcup_{i\in I}U_i$, $J_i$, and $U_{i,j}\morphism U_i$ be the associated data. For all $i\in I$, let $\Ss_i\subseteq \Ss$ be the subsieve of all morphisms $(v\colon U\morphism X)$ that factor through some $U_{i,j}$. We first show that we have an isomorphism
	\begin{equation*}
		\Ff(U_i)\isomorphism \limit_{v\in\Ss_i}\Ff(U)
	\end{equation*}
	To see this, note that the subdiagram spanned by all $\Ff(U_{i,j})$ and all $\Ff(U_{i,j}\times_X U_{i,k})$ for $j,k\in J_i$, together with the projection morphisms between them, is a coinitial subdiagram of the whole $\{\Ff(U)\}_{v\in\Ss_i}$. Indeed, that's basically the same argument as in the proof above (if $U\morphism X$ factors through $U_{i,j}$ and $U_{i,k}$, then also through $U_{i,j}\times U_{i,k}$). So we may as well take the limit over that subdiagram. But taking into account that $\Ff$ takes disjoint unions to products (because it restricts to an ordinary Zariski sheaf), the limit over said subdiagram is given by the equalizer of
	\begin{equation*}
		\Ff\Bigg(\coprod_{j\in J_i}U_{i,j}\Bigg)\doublemorphism[p_1^*][p_2^*]\Ff\Bigg(\coprod_{j\in J_i}U_{i,j}\times_X\coprod_{k\in J_i}U_{i,k}\Bigg)\,.
	\end{equation*}
	Since $\coprod_{j\in J_i}U_{i,j}\morphism U_i$ is in $\Cc$, our assumption on $\Ff$ shows that the above equalizer is just $\Ff(U_i)$, as claimed.
	
	For $i,i'\in I$ let $\Ss_{i,i'}\subseteq \Ss$ be the subsieve of all $U\morphism X$ that factor through some $U_{i,j}\times_XU_{i',j'}$ for $j\in J_i$, $j'\in J_{i'}$. In the same way as above we find an isomorphism
	\begin{equation*}
		\Ff(U_i\times_XU_{i'})\isomorphism \lim_{v\in\Ss_{i,i'}}\Ff(U)\,.
	\end{equation*}
	Now let $\Ss'\subseteq \Ss$ be the subsieve of all $U\morphism X$ that factor through $U_{i,j}$ for some $i\in I$, $j\in J_i$. By the above considerations, we find that the limit over the diagram $\{\Ff(U)\}_{v\in\Ss'}$ is the same as the limit over
	\begin{align*}
		\prod_{i\in I}\Ff(U_i)\doublemorphism[p_1^*][p_2^*]\prod_{i,i'\in I}\Ff(U_i\times_XU_{i'})\,,
	\end{align*}
	which is just $\Ff(X)$ by the usual Zariski sheaf axiom for $X$. So it remains to show that replacing $\Ss$ by $\Ss'$ doesn't change the limit. To see this, let $p\colon Y\morphism X$ be an element of $\Ss$ and let $V_i=Y\times_XU_i$, $V_{i,j}=Y\times_XU_{i,j}$. Repeating the above steps with $Y$ instead of $X$, we see that $\Ff(Y)$ is already determined by the $\Ff(V_{i,j})$. However, each $V_{i,j}\morphism X$ factors over $U_{i,j}$, i.e., lies in $\Ss'$. This shows that indeed it doesn't matter whether the limit is taken over all $v\in \Ss$ are all $v\in \Ss'$.
\end{proof}

\begin{exm}
	Let $F$ be any $S$-scheme. Then $\Hom_{\cat{Sch}/S}(-,F)\colon (\cat{Sch}/S)^\op\morphism\cat{Set}$ is a presheaf on $\cat{Sch}/S$. We claim that it is actually an fpqc sheaf, i.e., a sheaf on the site $(\cat{Sch}/S)_\fpqc$ (and then the same is true for $(\cat{Sch}/S)_\fppf$).
	
	To prove this, we use \cref{prop:fpqcSheaf} of course. It is easy to see that $\Hom_{\cat{Sch}/S}(-,F)$ is a sheaf in the Zariski topology (since morphisms can be glued). So it's left to check the second condition, i.e.,
	\begin{equation*}
		\Hom_{\cat{Sch}/S}(X,F)\isomorphism\left\{\phi\in\Hom_{\cat{Sch}/S}(X',F)\st \phi p_1=\phi p_2\text{ in }\Hom_{\cat{Sch}/S}(X'\times_XX',F)\right\}
	\end{equation*}
	whenever $X'\morphism X$ is an fpqc morphism. For fixed $X'\morphism X$, the condition that this holds for all $F$ is precisely the definition for $X'\morphism X$ being the coequalizer
	\begin{equation*}
		\Coeq\Big(X'\times_XX'\doublemorphism[p_1][p_2]X'\Big)\,.
	\end{equation*}
	But then again this is equivalent to $X'\morphism X$ being an effective epimorphism, which we proved in \cref{prop:fpqcEffectiveEpi}.
\end{exm}
\section{Étale Morphisms}
\lecture[Unramified and étale morphisms: definitions, basic properties; étale coverings; pullback of Kähler differentials under étale morphisms.]{2019-10-28}Most of the results of this section have already been featured in Professor Franke's lecture on Jacobians of curves. So check out \cite[Section~2.7]{jacobians} for more detailed proofs.
\begin{prop}\label{prop:unramified}
	Let $f\colon X\morphism Y$ be a morphism of locally finite type between locally noetherian preschemes. Then the following conditions are equivalent for all points $x\in X$:
	\begin{alphanumerate}
		\item We have $(\Omega_{X/Y})_x=0$.
		\item The diagonal $\Delta_{X/Y}\colon X\morphism X\times_YX$ is an open embedding at $x$.
		\item If $y=f(x)$, then $\mm_{X,x}=\mm_{Y,y}\Oo_{X,x}$, and the extension $\kappa(x)/\kappa(y)$ on residue fields is separable.
	\end{alphanumerate}
	If $f$ is separated (so that $\Delta_{X/Y}$ is a closed embedding), these are moreover equivalent to
	\begin{alphanumerate}\setcounter{enumi}{3}
		\item If $\Jj\subseteq \Oo_{X\times_YX}$ is the sheaf of ideals defining the closed embedding $\Delta_{X/Y}$, then $\Jj_w=0$ for $w=\Delta_{X/Y}(x)$.
	\end{alphanumerate}
\end{prop}
\begin{proof}[Sketch of a proof]
	Since the assertion is local, we may assume $X=\Spec B$ and $Y=\Spec A$. In this case, $f$ is automatically separated. Then \itememph{b} $\Rightarrow$ \itememph{d} follows basically from the fact that $\Jj$ is coherent. The equivalence with \itememph{a} follows from the following \cref{prop:Kähler} as follows. If $\Jj$ vanishes at $w$, then so does $\Omega_{X/Y}\cong \Delta_{X/Y}^*(\Jj/\Jj^2)$ at $x$. Conversely, if $(\Omega_{X/Y})_x=0$, then $(\Jj/\Jj^2)_w=0$, hence $\Jj_w=\Jj_w^2$, hence $\Jj_w=0$ by Nakayama. We won't prove the equivalence with \itememph{c} here, but you can find it in \cite[Lemma~2.7.2]{jacobians}.
\end{proof}
\begin{prop}\label{prop:Kähler}
	Let $f\colon X\morphism Y$ be a separated morphism of schemes and let $\Jj\subseteq \Oo_{X\times_YX}$ the sheaf of ideals defined by the closed embedding $\Delta_{X/Y}\colon X\morphism X\times_YX$. Then we have canonical isomorphisms
	\begin{equation*}
		\Omega_{X/Y}\cong \Delta_{X/Y}^*\Jj\cong \Delta_{X/Y}^*(\Jj/\Jj^2)\,.
	\end{equation*}
\end{prop}
\begin{proof}[Sketch of a proof]
	The assertion is local on $X$ and $Y$, hence it can be reduced to the affine case, where it follows from \cref{lem:Kähler} below.
\end{proof}
\begin{lem}\label{lem:Kähler}
	Let $B$ be an algebra over $A$. Let $I$ be the kernel of the multiplication map $B\otimes_AB\morphism B$. Then, canonically, 
	\begin{equation*}
		I/I^2\cong \Omega_{B/A}\,.
	\end{equation*}
\end{lem}
\begin{proof}[Sketch of a proof]
In fact, for any $B$-module $M$ we obtain a canonical bijection
\begin{align*}
\Hom_B(I/I^2,M)&\isomorphism \Der_A(B,M)\\
\phi&\longmapsto \d(b)=\phi(1\otimes b-b\otimes 1)\\
\phi(b_1\otimes b_2)=b_1\d(b_2)&\longmapsfrom \d
\end{align*}
(lots of things are to check here actually, but we leave it like that since this is also a pretty well-known fact).
\end{proof}
\begin{defi}
	\begin{alphanumerate}
		\item If the equivalent properties of \cref{prop:unramified} are satisfied, the morphism $f$ is called \defemph{unramified at $x$}. If $f$ is unramified at every $x\in X$, we call $f$ \defemph{unramified}.
		\item If the equivalent properties of \cref{prop:unramified} are satisfied and $f$ is moreover flat at $x$, then $f$ is called \defemph{étale at $x$}. If $f$ is étale at every $x\in X$, we call $f$ \defemph{étale}.
		\item The morphism $f$ is called an \defemph{étale covering} if it is finite and étale.
	\end{alphanumerate}
\end{defi}
\begin{fact}
	Let $f\colon X\morphism Y$ and $g\colon Y\morphism Z$ be morphisms of schemes.
	\begin{alphanumerate}
		\item The class of étale morphisms is stable under composition and base change, and being étale is a local property on source and target. The same holds for unramified morphisms.
		\item If $gf$ is étale and $g$ is unramified, then $f$ is étale.
		\item If $f$ is étale and a closed embedding, then $f$ is also an open embedding. In fact, this holds already when $f$ is flat and locally of finite presentation.
	\end{alphanumerate}
\end{fact}
\begin{proof}
	Part~\itememph{a}. It is clear from the definitions that being unramified is local on source and target. Moreover, from \cref{prop:unramified}\itememph{a} and the base change properties of Kähler differentials it is evident that being unramified is preserved under base change, and from \cref{prop:unramified}\itememph{c} we easily see that compositions of unramified morphisms are unramified again. Then the same follows for étale morphisms, since flat morphisms also have all these properties. This shows \itememph{a}.
	
	Part~\itememph{b}. We factor $f$ as
	\begin{equation*}
		\begin{tikzcd}
			X\rar["f"]\drar["{j=(\id_X,f)}"{swap}]& Y\\
			& X\times_ZY\uar["p"{swap}]
		\end{tikzcd}\,,
	\end{equation*}
	where $p$ is étale since it is a base change of $gf\colon X\morphism Z$. By \cref{prop:unramified}\itememph{b}, the diagonal $\Delta_{Y/Z}\colon Y\morphism Y\times_ZY$ is an open embedding. Hence so is $j$, since it is the base change of $\Delta_{X/Y}$ with respect to $(f,\id_Y)\colon X\times_YZ\morphism Y\times_ZY$. Hence $j$ is étale too (see \cref{exm:embeddings}\itememph{b} below), which by \itememph{a} proves that $f$ is étale as well.
	
	Part~\itememph{c}. Suppose $f$ is a flat closed embedding of locally finite presentation. Locally, $f$ looks like $\Spec A/I\monomorphism \Spec A$ for some finitely generated ideal $I\subseteq A$. As $A/I$ is flat over $A$, we have $I\otimes_AA/I\cong IA/I$. But the right-hand side is $0$, hence $I/I^2=0$. As $I$ is finitely generated, this implies $I_\pp=0$ for all prime ideals $\pp\in V(I)$ by Nakayama. But then for all such $\pp$ there is an $g\notin\pp$ such that already $I_g=0$. Hence $D(g)\subseteq V(I)$, proving that $\Spec A/I\monomorphism\Spec A$ is also an open embedding.
\end{proof}
\begin{fact}\label{fact:etaleFibres}
	Let $f\colon X\morphism Y$ be a morphism of locally finite type between locally noetherian schemes. Let $x\in X$, $y=f(x)$. Then $f$ is unramified at $x$ iff the fibre $f^{-1}\{y\}$ is unramified at $x$ over $\kappa(y)$. If, in addition, $f$ is flat at $x$, then it is étale at $x$ iff $f^{-1}\{y\}\morphism\Spec \kappa(y)$ is étale at $x$.
\end{fact}
\begin{proof}
	The residue fields of $x$ and $y$ don't change upon passing to $f^{-1}\{y\}\morphism\Spec\kappa(y)$, and likewise the condition $\Oo_{X,x}/\mm_{Y,y}\Oo_{X,x}\cong \kappa(x)$ is preserved. Hence \cref{prop:unramified}\itememph{c} shows that $f$ is unramified at $x$ iff $f^{-1}\{y\}\morphism\Spec\kappa(y)$ is unramified at $x$. Since flatness is preserved under base change, the second assertion follows at once.
\end{proof}
\begin{exm}\label{exm:embeddings}
	\begin{alphanumerate}
		\item Let $k$ be a field and $f\colon X\morphism \Spec k$ a morphism of finite type. Then $f$ is étale at $x\in X$ iff $\Oo_{X,x}$ is a finite separable field extension of $k$. This is a straightforward consequence of \cref{prop:unramified}\itememph{c}.
		\item Every open or closed embedding is unramified (this is clear from \cref{prop:unramified}\itememph{c}). Hence every open embedding is étale.
	\end{alphanumerate}
\end{exm}
\begin{lem}\label{lem:etaleTrace}
	Let $A$ be a finite-dimensional algebra over a field $k$. Then the following are equivalent:
	\begin{alphanumerate}
		\item $A$ is étale over $k$.
		\item We can write $A\cong \prod_{i=1}^{n}\ell_i$, where the $\ell_i$ are finite separable field extensions of $k$.
		\item The trace form $(a,b)\mapsto \Tr_{A/k}(ab)$ is a perfect pairing\footnote{To avoid ambiguity, we use the term \defemph{perfect pairing} rather than \defemph{non-degenerate pairing} for  bilinear forms $\langle -,-\rangle\colon P\times Q\morphism R$, with $P$ and $Q$ finite projective $R$-modules, that induce isomorphisms $P\isomorphism\Hom_R(Q,R)$ and $Q\isomorphism \Hom_R(P,R)$ (and actually either one follows from the other).} on $A\times A$.
	\end{alphanumerate}
\end{lem}
\begin{proof*}
	We prove \itememph{a} $\Leftrightarrow$ \itememph{b}. Since over a field everything is flat, the only question is whether $A$ is unramified. Since $A$ is finite-dimensional over $k$ and thus an artinian ring, we have 
	\begin{equation*}
		A\cong \prod_{i=1}^nA_{\mm_i}
	\end{equation*}
	where $\{\mm_1,\dotsc,\mm_n\}$ are the finitely many prime ideals of $A$ (see e.g.\ \cite[Corollary~2.16]{eisenbudCommAlg} for a proof). By \cref{exm:embeddings}\itememph{a}, $A$ is unramified at $\mm_i$ over $k$ iff $A_{\mm_i}$ is a finite separable field extension of $k$. This easily shows equivalence of \itememph{a} and \itememph{b}.
	
	If $\ell/k$ is a finite field extension, then a well-known assertion from classical field theory shows that $\Tr_{\ell/k}\colon \ell\times\ell\morphism k$ is perfect iff $\ell/k$ is separable. This immediately shows \itememph{b} $\Rightarrow$ \itememph{c}. For the converse, we only need to verify that all $A_{\mm_i}$ are fields. But if $x\in\mm_iA_{\mm_i}$, then $x$ is nilpotent in $A_{\mm_i}$, hence $a\mapsto \Tr_{A_{\mm_i}/k}(ax)$ is identically $0$ as nilpotent maps have vanishing trace. Thus $x=0$ as the trace pairing $\Tr_{A/k}$ is assumed perfect.
\end{proof*}
\begin{prop}\label{prop:finiteEtale}
	Let $f\colon X\morphism Y$ be a finite flat morphism between locally noetherian schemes, so $\Bb=f_*\Oo_X$ is a vector bundle on $Y$ in addition to being an $\Oo_Y$-algebra, and $X=\SPEC \Bb$. Then the following are equivalent:
	\begin{alphanumerate}
		\item $f$ is étale.
		\item The trace pairing, which is locally given by $(a,b)\mapsto \Tr_{\Bb/\Oo_Y}(ab)$, is perfect.
	\end{alphanumerate}
\end{prop}
\begin{proof}[Sketch of a proof\textup{*}]
	Since both assertions are local, we may assume that $X=\Spec B$ and $Y=\Spec A$ are affine, and moreover that $B$ is a finite free $A$-module. The trick is---of course---to reduce everything to fibres and apply \cref{lem:etaleTrace}. For condition \itememph{a} this is straightforward: since $B$ is already flat (even free) over $A$, étaleness can be checked on fibres by \cref{fact:etaleFibres}. So it suffices to transform \itememph{b} into a fibre-wise condition. To show that the map $B\morphism\Hom_A(B,A)$ induced by $\Tr_{B/A}$ is an isomorphism, it suffices to check that it is a locally split injection, since both sides are free $A$-modules of the same rank. But being a locally split injection in a neighbourhood of a prime $\pp\in\Spec A$ can be tested after tensoring with $\kappa(\pp)$. This is a very nice lemma that can be found in \cite[Ch.\:0 (19.1.12)]{egaIV1}. Thus also \itememph{b} can be tested on fibres, so everything reduces to \cref{lem:etaleTrace}. For more details, check out \cite[Proposition~2.7.2]{jacobians}.
\end{proof}
An interesting consequence is \cref{cor:etaleCodim2}. In fact, something much stronger is true: by a theorem of Zariski--Nagata, the étale fundamental group of a scheme doesn't change when a closed subscheme of codimension $\geq2$ is removed. %We might sketch a proof of this in one of the upcoming lectures.
\begin{cor}\label{cor:etaleCodim2}
	In the situation of \cref{prop:finiteEtale}, let $U\subseteq Y$ be an open subset such that every irreducible component of $Y\setminus U$ has codimension $\geq 2$. If the restriction $f|_{f^{-1}(U)}\colon f^{-1}(U)\morphism U$ is étale, then also $f$ is étale.
\end{cor}
\begin{proof*}
	Working locally, we may assume that $X=\Spec B$ and $Y=\Spec A$ are affine and $B$ is a finite free $A$-module. By \cref{prop:finiteEtale} it suffices to show that $\Tr_{B/A}$ induces an isomorphism $B\isomorphism \Hom_A(B,A)$. Since $B$ and $\Hom_A(B,A)$ are finite free $A$-modules of the same rank, this morphism is given by some square matrix $C$ with coefficients in $A$. Thus is suffices to show that $\det C$ is invertible in $A$. Since $B\morphism\Hom_A(B,A)$ is an isomorphism over $U$ by assumption, we see that $V(\det C)$ must be contained in $Y\setminus U$. But every irreducible component of $V(\det C)$ has codimension $\leq 1$ by Krull's principal ideal theorem. Thus $V(\det C)=\emptyset$, whence $\det C$ is indeed invertible.
\end{proof*}
\begin{prop}
	Let $f\colon X\morphism Y$ be an étale morphism between locally noetherian $S$-schemes. Then we have a canonical isomorphism
	\begin{align*}
		f^*\Omega_{Y/S}\isomorphism \Omega_{X/S}\,.
	\end{align*}
\end{prop}
\begin{proof}
	Surjectivity follows from the well-known short exact sequence
	\begin{equation*}
		f^*\Omega_{Y/S}\morphism\Omega_{X/S}\morphism\Omega_{X/Y}\morphism 0\,,
	\end{equation*}
	in which $\Omega_{X/Y}=0$ by \cref{prop:unramified} as $f$ is unramified. For injectivity, first note that the assertion is local on $X$, $Y$, and $S$. Hence without restriction they are all affine. Now consider the following diagram:
	\begin{equation*}
		\begin{tikzcd}
			X \ar[rr,mono,bend left=50, "\Delta_{X/S}"{swap}]\rar[mono,"\Delta_{X/Y}"]\drar["f"{swap}] & X\times_YX\dar\rar[mono]\drar[dash, phantom, "(\boxtimes)"] & X\times_SX\dar["p"]\\
			& Y\rar[mono,"\Delta_{Y/S}"] & Y\times_SY
		\end{tikzcd}
	\end{equation*}
	Since $X$, $Y$, and $S$ are affine and thus separated, the diagonaly $\Delta_{X/S}$, $\Delta_{Y/S}$, and $\Delta_{X/Y}$ are closed embeddings. Moreover, $\Delta_{X/Y}$ is also an open embedding by \cref{prop:unramified}\itememph{b}. Moreover, it's easy to see that \itememph{\boxtimes} is a pullback square. Hence also $X\times_YX\monomorphism X\times_SX$ is a closed embedding. Moreover, the pullback is taken along $p$, which is a flat since it factors into a composition $X\times_SX\morphism X\times_SY\morphism Y\times_SY$ of base changes of the flat morphism $f\colon X\morphism Y$. 
	
	Now let $\Jj_Y\subseteq \Oo_{Y\times_SY}$ be the ideal defined by $\Delta_{Y/S}$. Then commutativity of the diagram together with \cref{prop:Kähler} shows
	\begin{equation*}
		f^*\Omega_{Y/S}\cong f^*\Delta_{Y/S}^*\Jj_Y\cong \Delta_{X/S}^*p^*\Jj_Y\,.
	\end{equation*}
	Since $\Omega_{X/S}\cong \Delta_{X/S}^*\Jj_X$, where $\Jj_X$ defines the closed embedding $\Delta_{X/S}$, it suffices to identify $\Jj_X$ with $p^*\Jj_Y$ (we will immediately see why this is not quite true, but at least that's the spirit). Since $p$ is flat and \itememph{\boxtimes} a pullback square, $p^*\Jj_Y\subseteq \Oo_{X\times_SX}$ is the ideal defined by the closed embedding $X\times_YX\monomorphism X\times_SX$. Moreover, $\Delta_{X/Y}$ is an open-closed embedding. Hence $p^*\Jj_Y\subseteq \Jj_X$, and while they might not coincide, their pullbacks to $X$ are certainly equal. This shows indeed $f^*\Omega_{Y/S}\cong \Omega_{X/S}$, as claimed.
\end{proof}
\begin{prop}
	Let $f\colon X\morphism Y$ be a morphism of locally finite type between locally noetherian schemes. If $f$ is étale at $x\in X$ and $y=f(x)$, then $\Oo_{X,x}$ is regular iff so is $\Oo_{Y,y}$.
\end{prop}
\begin{proof*}
	Let $X_y=f^{-1}\{y\}$ be the fibre over $y$. Then $X_y\morphism\Spec \kappa(y)$ is étale at $x$. By \cref{exm:embeddings}\itememph{a}, $\Oo_{X_y,x}$ is a zero-dimensional ring. But since $\Oo_{X,x}$ is flat over $\Oo_{Y,y}$, equality holds in the inequality
	\begin{equation*}
		\dim\Oo_{X,x}\leq\dim\Oo_{Y,y}+\dim\Oo_{X_y,x}
	\end{equation*}
	(see \cite[\stackstag{00ON}]{stacks-project}). This shows
	\begin{equation}\label{eq:etaleDim}
		\dim\Oo_{X,x}=\dim\Oo_{Y,y}\,.
	\end{equation}
	Moreover, $\mm_{X,x}=\mm_{Y,y}\Oo_{X,x}\cong \mm_{Y,y}\otimes_{\Oo_{Y,y}}\Oo_{X,x}$ using \cref{prop:unramified}\itememph{c} and flatness. Hence $\mm_{X,x}/\mm_{X,x}^2\cong \mm_{Y,y}/\mm_{Y,y}^2\otimes_{\kappa(y)}\kappa(x)$. Thus
	\begin{equation}\label{eq:etaleResidue}
		\dim_{\kappa(x)}\mm_{X,x}/\mm_{X,x}^2=\dim_{\kappa(y)}\mm_{Y,y}/\mm_{Y,y}^2\,.
	\end{equation}
	Combining \cref{eq:etaleDim} and \cref{eq:etaleResidue} immediately shows that $\Oo_{X,x}$ is regular iff so is $\Oo_{Y,y}$.
\end{proof*}
\begin{prop}[{\cite[Arcata II Def.\ (1.1)]{sga4.5}}]\label{prop:formallyEtale}
	Let $R\morphism S$ be a map of finite type between noetherian rings. Then the following conditions are equivalent:
	\begin{alphanumerate}
		\item Let $A$ be an $R$-algebra with an ideal $I\subseteq A$ such that $I^2=0$. Then there is a canonical isomorphism $\Hom_R(S,A)\cong \Hom_R(S,A/I)$. In other words, for every solid \enquote{lifting problem} as below, there exists a unique dashed \enquote{solution}: 
		\begin{equation}\label{diag:formallyEtale}
			\begin{tikzcd}
				R\dar\rar & A\dar\\
				S\rar\urar[dashed,"\exists!"] & A/I
			\end{tikzcd}\,.
		\end{equation}
		\item[\itememph{a'}] Same as \itememph{a}, but $I$ is only nilpotent.
		\item[\itememph{a''}] Same as \itememph{a}, but we require this only for local rings $A$.
		\item $S$ is flat over $R$ and $\Omega_{S/R}=0$.
	\end{alphanumerate}
\end{prop}
\begin{proof*}
	Brace yourselves, for this proof is going to be lengthy. To make it as readable as possible, we break it into three parts.
	
	\emph{Proof of equivalence of \itememph{a}, \itememph{a'}, and \itememph{a''}.}
	It's clear that \itememph{a'} $\Rightarrow$ \itememph{a} $\Rightarrow$ \itememph{a''}. For the converse, let's show \itememph{a} implies \itememph{a'}. Let $I\subseteq A$ such that $I^n=0$. Using \itememph{a} repeatedly, we see that $S\morphism A/I$ lifts uniquely to some $S\morphism A/I^2$, which in turn lifts uniquely to some $S\morphism A/I^4$ etc. Inductively, we see that we get a unique lift to $A/I^{2^m}$ for all $m\geq 0$. Choosing $m$ such that $2^m\geq n$ provides a unique lift to $A=A/I^{2^m}$, as desired.
	
	Next, we show \itememph{a''} $\Rightarrow$ \itememph{a}. Suppose we are given a lifting problem as in \cref{diag:formallyEtale}. Condition \itememph{a''} provides unique lifts $S\morphism A_\pp$ of $S\morphism A_\pp/IA_\pp$ for every prime $\pp\in\Spec A$. But $S$ is of finite presentation over $R$ (since we assume it is of finite type and both are noetherian), so an easy argument shows that $S\morphism A_\pp$ already factors over $A_f$ for some $f\notin \pp$. Since this can be done for any prime $\pp$, we end up with a bunch of maps $S\morphism A_{f_i}$, where $i$ ranges over some indexing set $I$, and $\Spec A=\bigcup_{i\in I}D(f_i)$. Moreover, for any $i,j\in I$, the diagram
	\begin{equation*}
		\begin{tikzcd}
			S \rar\dar & A_{f_i}\dar\\
			A_{f_j}\rar & A_{f_if_j}
		\end{tikzcd}
	\end{equation*}
	commutes. Indeed, this follows from the fact that for any prime $\qq\in D(f_if_j)$ the induced map $S\morphism A_\qq$ is uniquely determined as a lift of $S\morphism A_\qq/IA_\qq$, by the uniqueness condition of \itememph{a''}. Thus, the maps $S\morphism A_{f_i}$ determine a unique map $S\morphism A$ with the desired properties. To put it in fancy words: here we used that $\Hom_{\cat{Sch}}(-,\Spec S)$ is a sheaf in the Zariski topology. This concludes the proof of equivalence of \itememph{a}, \itememph{a'}, and \itememph{a''}.
	
	\emph{Proof of \itememph{b} $\Rightarrow$ \itememph{a}.} We first show that any lift in \cref{diag:formallyEtale} is unique if it exists. Suppose there are two lifts $\phi_1,\phi_2\colon S\morphism A$ of $\ov{\phi}\colon S\morphism A/I$, where the ideal $I$ satisfies $I^2=0$. Now consider $d=\phi_1-\phi_2$ as a map $d\colon S\morphism A$ of $R$-modules. By assumption, $d$ takes values in $I$ and vanishes on elements in the image of $R\morphism S$. Moreover, since $I=I/I^2$, it can be regarded as an $A/I$-module. Thus, for all $s,t\in S$, we obtain
	\begin{align*}
		d(st)=\phi_1(s)\phi_1(t)-\phi_2(s)\phi_2(t)&=(\phi_1(s)-\phi_2(s))\phi_1(t)+\phi_2(s)(\phi_1(t)-\phi_2(t))\\
		&=d(s)\ov{\phi}(t)+\ov{\phi}(s)d(t)\,.
	\end{align*}
	Thus, $d\colon S\morphism I$ is a derivation. However, $\Der_R(S,I)=\Hom_S(\Omega_{S/R},I)=0$ as $\Omega_{S/R}=0$. This shows $\phi_1=\phi_2$ and thus uniqueness of lifts.
	
	Now for existence. Since $S$ is finitely presented over $R$, we may write it as $S\cong T/J$, where $T=R[x_1,\dotsc,x_n]$ is a polynomial ring over $R$ and $J\subseteq T$ a finitely generated ideal. We claim that among all possible lifting problems like \cref{diag:formallyEtale}, it is enough to solve the following one:
	\begin{equation}\label{diag:formallyEtale2}
		\begin{tikzcd}
		R\dar\rar & T/J^2\dar\\
		S\rar[iso]\urar[dashed] & T/J
		\end{tikzcd}\,.
	\end{equation}
	Indeed, if any other lifting problem like \cref{diag:formallyEtale} is given, there always exists a lift $\psi\colon T\morphism A$ of $\ov{\phi}\colon S\morphism A/I$ (that's just polynomial rings being awesome). But then $\psi(J)\subseteq I$, hence $\psi(J^2)\subseteq I^2=0$. This shows that $\psi$ factors over some $\ov{\psi}\colon T/J^2\morphism A$. But then composing $\ov{\psi}$ with $S\morphism T/J^2$ from \cref{diag:formallyEtale2} produces a solution $S\morphism A$ of our lifting problem, as desired.
	
	Thus, it's enough to produce a split of $T/J^2\morphism T/J$. By \cite[Proposition~16.12]{eisenbudCommAlg}, this is equivalent to the condition that the left-most arrow in the conormal sequence
	\begin{equation*}
		J/J^2\morphism \Omega_{T/R}\otimes_TS\morphism\Omega_{S/R}\morphism 0
	\end{equation*}
	is a split monomorphism. But $\Omega_{S/R}=0$ by assumption, so $J/J^2\morphism\Omega_{T/R}\otimes_TS$ is a split monomorphism iff it is an isomorphism iff it is a locally split monomorphism. The latter condition can be checked on fibres. More precisely, by \cite[Ch.\:0 (19.1.12)]{egaIV1} it is enough to see that
	\begin{equation*}
		J/J^2\otimes_S\kappa(\ov\qq)\morphism\Omega_{T/R}\otimes_TS\otimes_S\kappa(\ov{\qq})
	\end{equation*}
	is injective for all primes $\ov{\qq}\subseteq \Spec T/J$. Let $\qq\in\Spec T$ be the prime over $\ov{\qq}$. Then $\kappa(\qq)=\kappa(\ov\qq)$, so we may instead work with $\qq$ everywhere. Let $\pp\in\Spec R$ be the preimage of $\qq$. Then it doesn't matter if we tensor the above sequence with $-\otimes_R\kappa(\pp)$ first and then $-\otimes_T\kappa(\qq)$ , or just with $-\otimes_T\kappa(\qq)$. Hence we may replace $\Omega_{T/R}$ by $\Omega_{T/R}\otimes_R\kappa(\pp)\cong \Omega_{T\otimes_R\kappa(\pp)/\kappa(\pp)}$ and $J$ by $J\otimes_R\kappa(\pp)$. Note that $J\otimes_R\kappa(\pp)\morphism T\otimes_R\kappa(\pp)$ is injective since $\Tor_1^R(\kappa(\pp),T/J)=0$, as $S\cong T/J$ is flat over $R$. In particular, $J\otimes_R\kappa(\pp)$ is an ideal in $T\otimes_R\kappa(\pp)$.
	
	So what use is that to us? Well, now we can replace $R$ by $\kappa(\pp)$! Thus, we are in the same situation as before, but now $R$ is a field $k=\kappa(\pp)$. This makes things much easier! First of all, since $S$ has finite type over $k$,
	$\Omega_{S/k}=0$ shows that
	\begin{equation*}
		S=\prod_{i=1}^m\ell_i
	\end{equation*}
	is a finite product of separable field extensions $\ell_i/k$ (see \cite[Corollary~16.16]{eisenbudCommAlg} for a proof). In particular, $S$ is artinian and the $\ell_i$ are its localizations at prime ideals. Thus, $S_{\ov{\qq}}\cong \kappa(\ov{\qq})\cong \kappa(\qq)$, and $\kappa(\qq)$ is separable over $k$. 
	
	Now we want to show that
	\begin{equation*}
		J/J^2\otimes_T\kappa(\qq)\morphism\Omega_{T/k}\otimes_T\kappa(\qq)
	\end{equation*}
	is injective. Note that $J/J^2\otimes_T\kappa(\qq)\cong J_\qq/\qq J_\qq$, as $J\subseteq \qq$. But $T_\qq/J_\qq\cong S_{\ov{\qq}}\cong \kappa(\qq)$. Hence $J_\qq=\qq T_\qq$ is already the maximal ideal of the local ring $T_\qq$. Moreover,
	\begin{equation*}
		\Omega_{T/k}\otimes_T\kappa(\qq)\cong \Omega_{T_\qq/k}\otimes_{T_\qq}\kappa(\qq)\,.
	\end{equation*}
	Hence what we want to show is that
	\begin{equation*}
		\qq/\qq^2\morphism\Omega_{T_\qq/k}\otimes_{T_\qq}\kappa(\qq)\,.
	\end{equation*}
	is injective. Now $T_\qq=k[x_1,\dotsc,x_n]_\qq$ is a noetherian local ring containing $k$, and its residue field $\kappa(\qq)$ is separable over $k$. Thus, we may apply \cite[\stackstag{00TU}]{stacks-project}, which precisely gives us that the above map is injective (the proof of this lemma basically constructs a splitting of the morphism in question). We are done!
	
	\emph{Proof of \itememph{a} $\Rightarrow$ \itememph{b}.} We first show $\Omega_{S/R}=0$. Consider any lifting problem like \cref{diag:formallyEtale}. Then $\ov{\phi}\colon S\morphism A/I$ has a unique lift $\phi\colon S\morphism A$. However, reversing the argument in the proof of \itememph{b} $\Rightarrow$ \itememph{a}, we see that any derivation $d\colon S\morphism I$ gives rise to another solution $\phi+d\colon S\morphism A$ of the lifting problem. Thus, $0=\Der_A(S,I)=\Hom_S(\Omega_{S/R},I)$ holds in all such situations. Now consider $A=S\oplus\Omega_{S/R}$, with its natural $S$-module structure. We can extend this to a natural graded ring structure via $\omega_1\omega_2=0$ for all $\omega_1,\omega_2\in \Omega_{S/R}$. Thus, $A$ is an $S$-algebra with an ideal $I=\Omega_{S/R}$ that satisfies $I^2=0$. Applying our previous considerations, we see $0=\Hom_S(\Omega_{S/R},\Omega_{S/R})$, whence $\Omega_{S/R}=0$, as desired.
	
	It remains to show that $S$ is flat over $R$. Since $R$ and $S$ are assumed to be noetherian, there is actually a very quick argument: write $S\cong T/J$, where $T=R[x_1,\dotsc,x_n]$ is a polynomial ring. Then \itememph{a'} shows that the isomorphism $S\isomorphism T/J$ lifts to unique maps $S\morphism T/J^n$ for all $n>0$. Hence, if $\roof{T}$ is the $J$-adic completion of $T$, then $\roof{T}\epimorphism S$ has a unique split $S\morphism \roof{T}$. In particular, $S$ is a direct summand of $\roof{T}$. But $\roof{T}$ is flat over $T$, which is flat over $R$, so $S$ too is flat over $R$.
\end{proof*}
\begin{rem}
	\cite[Arcata]{sga4.5} has only conditions \itememph{a} and \itememph{b}, together with another condition \itememph{c}, which is a Jacobian-like criterion. Moreover, $R$ doesn't need to be noetherian; instead it is assumed that $S$ is finitely presented over $R$. Then the equivalent conditions are used as a definition \defemph{étale ring maps}.
\end{rem}
\begin{rem*}
	Our proof* of \cref{prop:formallyEtale} works for the non-noetherian case as well---except for the very last step: completions of non-noetherian rings need not be flat! Here we present a way to circumvent this argument.
	
	As usual, write $S\cong T/J$, and let $\ov{\qq}\in \Spec S$ be a prime with preimages $\qq\in \Spec T$ and $\pp\in \Spec R$. It suffices to show that $S_{\ov{\qq}}$ is flat over $R_\pp$. Our goal is to show that $J_\qq$ can be generated by elements $f_1,\dotsc,f_c$, whose images in $T_\qq/\pp T_\qq$ form a regular sequence. Then \cite[\stackstag{0470}]{stacks-project} can be applied to see that $S_{\ov\qq}\cong T_\qq/J_\qq$ is flat over $R_\pp$.
	
	Our first goal along that way is to show that $J_\qq/\qq J_\qq\morphism\qq/\qq^2$ is injective. One way to see this is to show that even $J_\qq=\qq T_\qq$ holds, by an argument as in the proof of \itememph{b} $\Rightarrow$ \itememph{a}. Here we use a different argument, that also works in more general situations. First note that
	\begin{equation*}
		J/J^2\morphism\Omega_{T/R}\otimes_TS
	\end{equation*}
	is split injective. Indeed, this follows from \cite[Proposition~16.12]{eisenbudCommAlg}, because the projection map $T/J^2\morphism T/J\cong S$ admits a splitting by \cref{prop:formallyEtale}\itememph{a}. In particular, the above map stays injective under tensoring with $\kappa(\qq)$, i.e.,
	\begin{equation*}
		J_\qq/\qq J_\qq\morphism\Omega_{T_\qq/R_\pp}\otimes_{T_\qq}\kappa(\qq)
	\end{equation*}
	is injective. But this map factors through $\qq/\qq^2$ via the conormal sequence
	\begin{equation*}
		\qq/\qq^2\morphism\Omega_{T_\qq/R_\pp}\otimes_{T_\qq}\kappa(\qq)\morphism\Omega_{\kappa(\qq)/R_\pp}\morphism 0\,
	\end{equation*}
	hence $J_\qq/\qq J_\qq\morphism \qq/\qq^2$ is indeed injective. Now choose a basis $(\ov{f}_1,\dotsc,\ov{f}_c)$ of the $\kappa(\qq)$-vector space $J_\qq/\qq J_\qq$ and extend it to a basis $(\ov{f}_1,\dotsc,\ov{f}_d)$ of $\qq/\qq^2$ (note that $\qq/\qq^2$ is finite-dimensional since $T_\qq/\pp T_\qq\cong \kappa(\pp)[x_1,\dotsc,x_n]_\qq$ is noetherian, even though $T_\qq$ need not be noetherian). For all $i=1,\dotsc,c$ choose lifts $f_i\in J_\qq$ of $\ov{f}_i$By Nakayama's lemma, the $f_i$ generate $J_\qq$. Moreover, their images in $T_\qq/\pp T_\qq$ are part of a minimal generating system of the maximal ideal $\qq (T_\qq/\pp T_\qq)\subseteq T_\qq/\pp T_\qq$. Indeed, just choose lifts $f_j\in T_\qq/\pp T_\qq$ of the $\ov{f}_j$ for $j=c+1,\dotsc,d$ to get a complete minimal generating system of $\qq(T_\qq/\pp T_\qq)$, by a well-known Nakayama argument.
	
	But $T_\qq/\qq T_\qq$ is a regular local ring because it is a localization of $\kappa(\pp)[x_1,\dotsc,x_n]$ at some prime ideal. Hence any minimal generating system of its maximal ideal form a regular sequence (see \cite[\stackstag{00NQ}]{stacks-project} or the proof of \cite[Proposition~2.2.1]{homalg}). This shows that $f_1,\dotsc,f_c$ have the required property and we are done.
\end{rem*}

\appendix
\backmatter\KOMAoption{chapterprefix}{false}
\printbibliography[prenote=LINKS]
\end{document}