\documentclass[a4paper, 10pt, oneside, DIV=9, chapterprefix=true, numbers=enddot, bibliography=totoc]{scrbook}
\usepackage{StyleEtaleI}
\usepackage{ShortcutsEtaleI}
\usepackage{halloweenmath}
\usetikzlibrary{shapes.geometric}
\usepackage{tikzducks,tikzsymbols}
\usepackage[normalem]{ulem}


\makeatletter
\renewcommand{\@pnumwidth}{2em} 
\renewcommand{\@tocrmarg}{3em}
\makeatother


\DeclareRobustCommand{\Attention}{\tikz[baseline, anchor=base]\node[draw, regular polygon, regular polygon sides=3, rounded corners=2, thick, inner sep=-0.25pt] at (0,0) {\textbf{!}};}

\newcommand{\magic}{%
	\smash{\tikz[scale=0.125, baseline=-3]{%
		\fill (-0.65,0) -- (0.65,0) -- (0.65,-1.1) -- (-0.65, -1.1) -- cycle;%
		\fill (0,-1.1) ellipse (0.65 and 0.195);%
		\fill[white] (0,-0.15) ellipse (1 and 0.3);%
		\fill (0,0) ellipse (1 and 0.3);%
		\fill[white] (0,0) ellipse (0.6 and 0.18);%
		\draw[line width=1, line cap=round] (1.75,-0.25) -- (0.6,0.9);
		\draw[line width=0.375, white, line cap=round] (0.9,0.6) -- (0.6,0.9);
		\node[fill, scale=0.125, star, star point ratio=0.42, rotate=180] at (0.1,1) {};
		\node[fill, scale=0.25, star, star point ratio=0.42, rotate=180] at (-0.4,0.7) {};
		\node[fill, scale=0.25, star, star point ratio=0.42, rotate=180] at (-0.75,1.25) {};
		\node[fill, scale=0.2, star, star point ratio=0.42, rotate=180] at (-0.1,1.6) {};
	}}
}

\newcommand{\mysteriousduck}{%
	\smash{\tikz[baseline=(guenther-bill), scale=0.3]\duck[name=guenther, tshirt=white, grumpy, body=white, hat=black,sunglasses=black,  bill=black!25!white];}\hspace{-0.4em}
}

\subject{Lecture Notes for}
\title{Étale Cohomology I}
\author{{\normalsize Lecturer}\\
	Jens Franke}
\date{{\normalsize Notes typed by}\\
	Ferdinand Wagner}
\publishers{Winter Term 2019/20\\
University of Bonn}

%\includeonly{nothingtoseehere}
%\includeonly{./Chapters/EtaleIAppendix}
%\includeonly{./Chapters/EtaleI11to163}
%\includeonly{./Chapters/EtaleI164to17}
%\includeonly{./Chapters/EtaleI21to24}
%\includeonly{./Chapters/EtaleI25to26}
\begin{document}
\frontmatter
\KOMAoption{chapterprefix}{false}
\maketitle
\noindent This text consists of notes on the lecture Advanced Topics in Algebraic Geometry (Étale Cohomology I), taught at the University of
Bonn by Professor Jens Franke in the winter term (Wintersemester) 2019/20.

Some changes and some additions have been made by the author. To distinguish them from the lecture's actual contents, they are labelled with an asterisk. So any \emph{Lemma}* or \emph{Remark}* or \emph{Proof}* that the reader might come across are wholly the author's responsibility.\\[\thmsep]Please report errors, typos etc.\ through the \emph{Issues} feature of GitHub.


\tableofcontents
\listoftoc{lol}
\chapter{Preface}
\numpar*{Organizational stuff}As a result of a democratic decision in the preliminary meeting, the lecture will take place on Mondays from from 18:00 to 20:00 and on Fridays from 16:00 to 18:00, in the \enquote{Großer Hörsaal}.

Recommended prerequisites to this lecture are
\begin{temize}
	\item flat morphisms and faithfully flat descent,
	\item abelian varieties, in particular, the Jacobian of a curve.
\end{temize}
Nevertheless, Professor Franke promised to give a quick reminder on flat and étale morphisms in the first lecture. Moreover, typed lecture notes are available for Professor Franke's lecture on Jacobians of curves held in the winter term 2018/19 (see \cite{jacobians}). 

The goal of this lecture is to eventually define the \emph{$\ell$-adic cohomology} of a scheme $X$, where $\ell\neq p$ is a prime different from the characteristic $p$ of $X$. These groups will be constructed as
\begin{align*}
	H^i(X_\et,\IZ_\ell)=\limit_{n\geq 1}H^i(X_\et,\IZ/\ell^n\IZ)\,.
\end{align*}
Along the way, we will come across sheaves on the étale site, the relation between étale and Galois cohomology, cohomology of curves, and proper base change.

\emph{Professor Franke offered a Q\&A session, especially for those of you taking the exam. It will take place on Monday $3\ordinalrd$ at 18:00 in the \enquote{Großer Hörsaal}.}

\numpar*{Sequel on Weil I and seminar next semester}
Professor Franke has confirmed there will be a follow-up lecture on Deligne's first proof of the Weil conjectures. It will take place on Tuesdays from 16:00 to 18:00 in a room tba, and on Fridays from  16:00 to 18:00 in the \enquote{Großer Hörsaal}. The plan is to present Deligne's proof in the very beginning, and then to work backwards through the proofs of the hard technical results required. So hopefully, the end of the sequel and the end of the current lecture will meet.

Professor Franke additionally intends to offer a seminar about étale cohomology. This provides the opportunity to present proofs that we would otherwise not have time for in the Weil~I lecture, and reduce the overall amount of blackboxing. \emph{The preliminary meeting is on Friday $7\ordinalth$ February at 16:00 in the \enquote{Großer Hörsaal}.}

\numpar*{Author's note}
In these notes, the modern meaning of the word \emph{scheme} is used. That is, a scheme in these lecture notes is what Professor Franke would call a \emph{prescheme}, and what he would call a \emph{scheme} will be called a \emph{separated scheme} in here.

Also I will not follow Franke's numbering scheme\footnote{\ldots\ if not to say, numbering \emph{prescheme}.}, as I believe this document is easier to navigate if propositions/lemmas/etc.\ are numbered consecutively rather than independent of each other. 

%\numpar*{\Attention\ Important note}\textbf{I won't be in Bonn on the 20th and 23rd Decembre, so I'm going to miss the last two Étale lectures in 2019!}
%This means \textbf{no lecture notes} \dotso unless \emph{you} help me out! I would very much appreciate if one of you could share their notes with me. You can just send a photo to my e-mail address \href{mailto:ferdinand.wagner@uni-bonn.de}{\texttt{ferdinand.wagner@uni-bonn.de}}. Of course you can also send me \TeX\ code or even a pull request (well, less work for me), but I'm perfectly happy with \sout{any handwritten notes} readable handwritten notes. Merry Christmas!

\mainmatter\KOMAoption{chapterprefix}{true}
\include{./Chapters/EtaleI11to163}
\include{./Chapters/EtaleI164to17}
\include{./Chapters/EtaleI21to24}
\include{./Chapters/EtaleI25to26}




\chapter{Proper Base Change}
\section{Formulation and Proof of the Main Theorem}
\numpar{}\label{par:pullbackMorphism}\lecture[The base change morphism. The proper base change theorem. Proof of the proper base change theorem. Thanks to Konrad for sharing his notes (and enduring 40 minutes overtime \Annoey{})!]{2020-01-27}Let $g\colon X'\morphism X$ be a morphism of schemes. If $\Ff\in \cat{Ab}(X_\et)$ is an étale sheaf, we have a functorial morphism $g^*\colon \Global(X,\Ff)\morphism \Global(X',g^*\Ff)$. Applying the universal property of derived functors gives a pullback morphism
\begin{equation}\label{eq:pullback}
	g^*\colon H^\bullet(X_\et,\Ff)\morphism H^\bullet(X'_\et,g^*\Ff)
\end{equation}
of cohomological functors (note that the right-hand side is indeed a cohomological functor, because $g^*\colon \cat{Ab}(X_\et)\morphism \cat{Ab}(X'_\et)$ is exact). Now suppose $g$ sits in a pullback diagram
\begin{equation*}
	\begin{tikzcd}
		X'\rar["g"]\dar["p'"']\drar[pullback]& X\dar["p"]\\
		S'\rar["f"] & S
	\end{tikzcd}\,.
\end{equation*}
For all $i\geq 0$ let $\Hh^i(\Ff)$ be the presheaf on $S_\et$ given by $U\mapsto H^i((X\times_SU)_\et,\Ff)$. Likewise, let $\Hh^i(g^*\Ff)$ be the presheaf on $S'_\et$ given by $U'\mapsto H^i((X'\times_{S'}U')_\et,g^*\Ff)$. Observe that the sheafification of $\Hh^i(\Ff)$ is $R^ip_*\Ff$ and the sheafification of $\Hh^i(g^*\Ff)$ is $R^ip'_*g^*\Ff$. Moreover, \cref{eq:pullback} provides a canonical morphism
\begin{equation*}
	\Hh^i(\Ff)\morphism f_*\Hh^i(g^*\Ff)\,.
\end{equation*}
Indeed, after unraveling definitions we see that such a morphism of presheaves is given by a system of compatible morphism $H^\bullet((X\times_SU)_\et,\Ff)\morphism H^\bullet((X'\times_SU)_\et,g^*\Ff)$ for $U\in S_\et$, which can be obtained by applying \cref{eq:pullback} to the base change $X'\times_SU\morphism X\times_SU$ of $g$ instead to $g$ itself (then also compatibility is clear from the universal property of derived functors). Thus, after sheafification, we get a canonical morphism  $R^ip_*\Ff\morphism f_*R^ip'_*g^*\Ff$. Taking the adjoint and letting $i$ vary finally provides a natural morphism of cohomological functors
\begin{equation}\label{eq:baseChangeMorphism}
	f^*R^\bullet p_*\Ff\morphism R^\bullet p'_*g^*\Ff\,,
\end{equation}
which is called the \defemph{base change morphism}.
\begin{rem}\label{rem:baseChangeSpecialCases}
	We would like to work out some important special cases, and analyze the behaviour of \cref{eq:baseChangeMorphism} under composition.
	\begin{alphanumerate}
		\item If $g$ is finite, then $R^ig_*g^*\Ff=0$ for all $i>0$ by \cref{prop:Rifinite=0}, hence an isomorphism $H^i(X'_\et,g^*\Ff)\cong H^i(X_\et,g_*g^*\Ff)$ holds by the Leray spectral sequence (\cref{prop:etaleLeray}). The same is true more generally when $g$ is only integral. The idea is to write $g\colon X'\morphism X$ as a cofiltered limit over finite morphisms $g_\alpha\colon X_\alpha\morphism X$ (which is, at least étale-locally, always possible). One then checks that \cref{prop:cohoInverseLimit} provides an isomorphism $\colimit \Hh^i(g_\alpha^*\Ff)\cong \Hh^i(g^*\Ff)$. Sheafification, being a left-adjoint functor, commutes with colimits, hence $0=\colimit R^ig_{\alpha,*}g_\alpha^*\Ff\cong R^ig_*g^*\Ff$ for all $i>0$, as claimed.
		
		In this case, \cref{eq:pullback} may be obtained by applying $H^\bullet(X_\et,-)$ to the unit $\Ff\morphism g_*g^*\Ff$ of the $g^*$-$g_*$ adjunction (which, as usual, follows from the uniqueness part of the universal property of derived functors).
		\item A special case of \cref{eq:baseChangeMorphism} is the following: suppose $\ov{s}\colon \Spec \kappa(\ov{s})\morphism S$ is a geometric point of $S$, and we have $S'=\Spec \kappa(s)$ and $f=\ov{s}\colon \Spec \kappa(\ov{s})\morphism S$. Then the base change morphism takes the form
		\begin{equation*}
			(R^\bullet p_*\Ff)_{\ov{s}}\morphism H^\bullet\big(X_{0,\et},\pr_1^*\Ff\big)\,,
		\end{equation*}
		where $X_0= X\times_S\Spec \kappa(\ov{s})$ and $\pr_1\colon X_0\morphism X$ is the projection to the first factor.
		\item The base change morphism \cref{eq:baseChangeMorphism} satisfies the obvious compatibility relation: given a double pullback diagram
		\begin{equation*}
			\begin{tikzcd}
				X''\drar[pullback]\rar["g'"]\dar["p''"'] & X'\drar[pullback]\rar["g'"]\dar["p'"] & X\dar["p"]\\
				S''\rar["f'"] & S'\rar["f"] & S
			\end{tikzcd}\,,
		\end{equation*}
		the diagram of base change morphisms
		\begin{equation*}
			\begin{tikzcd}
				f'^*f^*R^\bullet p_*\Ff\dar["f'^*\text{\cref{eq:baseChangeMorphism}}"']\rar["\text{\cref{eq:baseChangeMorphism}}"] & R^\bullet p''_*(f\circ f')^*\Ff\eqar[d] \\
				f'^*R^\bullet p'_*g^*\Ff\rar["\text{\cref{eq:baseChangeMorphism}}"] & R^\bullet p''_*f'^*f^*\Ff
			\end{tikzcd}
		\end{equation*}
		is commutative. Like all assertions of these kind, this follows from the uniqueness part of the universal property of derived functors.
	\end{alphanumerate}
\end{rem}
And now, after months of teasing and foreshadowing, now is the moment when we finally state and prove the proper base change theorem!
\begin{thm}[Artin/Grothendieck]\label{thm:properBaseChange}
	Suppose we are in the situation of \cref{par:pullbackMorphism} (all schemes are not necessarily noetherian). If $p\colon X\morphism S$ is proper and $\Ff$ is a torsion sheaf on $X_\et$ in the sense of \cref{rem*:torsion}\itememph{c}, then the base change morphism \cref{eq:baseChangeMorphism} is an isomorphism
	\begin{equation*}
		f^*R^i p_*\Ff\isomorphism R^i p'_*g^*\Ff
	\end{equation*}
	for all $i\geq 0$.
\end{thm}
Before we get into the proof, we take the time to discuss some corollaries. The first one wasn't mentioned in the lecture, and is actually not a corollary, but a generalization to derived categories (stop whining already!). I decided to include it anyway, because---believe me---it will make the \enquote{dévissage} arguments in the proof of \cref{thm:properBaseChange} \emph{so much cleaner}! We denote by $D^+(X_\et)$ the bounded below derived category of $\cat{Ab}(X_\et)$.
\begin{cor*}\label{cor:derived}
	Suppose we are in the situation of \cref{par:pullbackMorphism}. If $p\colon X\morphism S$ is proper and $K^\bullet\in D^+(X_\et)$ is a complex whose cohomology are torsion sheaves, then the canonical morphism
	\begin{equation*}
		f^*Rp_*K^\bullet\isomorphism Rp'_*g^*K^\bullet
	\end{equation*}
	is an isomorphism in $D^+(S'_\et)$.
\end{cor*}
\begin{proof*}
	This is a formal consequence of \cref{thm:properBaseChange}, but I haven't done such a thing before, so I try to be in-depth. We first reduce the assertion to bounded complexes $K^\bullet\in D^b(X_\et)$. Fix a cohomological degree $i$ in which to check the isomorphism. $Rp_*K^\bullet$ can be computed as follows: choose a quasi-isomorphism $K^\bullet\isomorphism \Ii^\bullet$ into a complex of injective sheaves, and take $Rp_*K^\bullet=p_*\Ii^\bullet$. The standard procedure to produce $\Ii^\bullet$ is to take a Cartan--Eilenberg resolution $K^\bullet\morphism \Jj^{\bullet,\bullet}$ and then take $\Ii^\bullet$ to be the total complex of $\Jj^{\bullet,\bullet}$. Let $\tau_{\leq n}K^\bullet$ be the soft truncation of $K^\bullet$, i.e., the complex obtained by replacing $K_n$ by $\ker (K^n\morphism K^{n+1})$ and $K^j$ for $j>n$ by $0$. Also note that we can choose a Cartan--Eilenberg resolution of $\tau_{\leq n}K^\bullet$ in such a way that it is part of a Cartan--Eilenberg resolution of $K^\bullet$. In particular, the induced injective resolutions of both complexes will coincide up to degree $n-1$. Choosing $n$ large enough, we get that $f^*Rp_*K^\bullet$ and $f^*Rp_*\tau_{\leq n}K^\bullet$ coincide in cohomological degree $i$. A similar argument applies to the right-hand side, whence we have reduced the assertion to finite complexes.
	
	To deal with finite complexes, we do induction on the number of non-zero cohomological degrees. If that number is $1$, we have $K^\bullet\cong \Ff[i]$ for some torsion sheaf $\Ff$ placed in some degree $i$, and the assertion follows from \cref{thm:properBaseChange}. Now assume that $K^\bullet$ is concentrated between degrees $0$ and $n+1$. The mapping cone of $\tau_{\leq n}K^\bullet\morphism K^\bullet$ is quasi-isomorphic to a complex consisting of $\Ff=H^{n+1}(K^\bullet)$, which is a torsion sheaf, placed in degree $n+1$. Applying the induction hypothesis to $\tau_{\leq n}K \bullet$ and $\Ff[n+1]$ proves the assertion for $K^\bullet$ by means of the distinguished triangle $\tau_{\leq n}K^\bullet\morphism K^\bullet\morphism \Ff[n+1]\morphism \tau_{\leq n}K^\bullet[1]$ in $D^+(X_\et)$.
\end{proof*}
We would like to discuss another two corollaries. The first one wasn't in the lecture, but it's closely related to a technical complication that Professor Franke just ignored---and so did Deligne in \cite[Arcata~IV]{sga4.5} (or I'm just too dumb to see a trivial argument). So it's definitely worth pointing out.
\begin{cor*}\label{cor*:fuckUp}
	Let $K/k$ be a (not necessarily algebraic) extension of separably closed fields. Let $X$ be a proper scheme over $k$ and $X_K=X\times_k\Spec K$. If $\Ff$ is a torsion sheaf on $X_\et$ and $\Ff_K$ its pullback to $X_{K,\et}$, then the canonical morphism
	\begin{equation*}
		H^i(X_\et,\Ff)\isomorphism H^i\big(X_{K,\et},\Ff_K\big)
	\end{equation*}
	is an isomorphism for all $i\geq 0$.
\end{cor*} 
\begin{cor}\label{cor:properBaseChange}
	Let $p\colon X\morphism S$ be proper and $S=\Spec A$, where $A$ is a strictly henselian local ring with residue field $k$. Let $S_0= \Spec k$ and $\ov{s}\colon S_0\monomorphism S$ denote the corresponding geometric point. Then for all torsion sheaves $\Ff$ on $X_\et$ the canonical morphism
	\begin{equation*}
		H^i(X_\et,\Ff)\isomorphism H^i\big(X_{0,\et},\pr_1^*\Ff\big)
	\end{equation*}
	is an isomorphism for all $i\geq 0$, where $X_0=X\times_SS_0$ and $\pr_1\colon X_0\morphism X$ is the projection to the first factor.
\end{cor}
\begin{rem}\label{rem:fuckUp}
\cref{cor*:fuckUp} is the special case of \cref{thm:properBaseChange} applied in the case where $S=\Spec k$ and $S'=\Spec K$. Similarly,
\cref{cor:properBaseChange} is the special case of \cref{thm:properBaseChange} applied in the situation of \cref{rem:baseChangeSpecialCases}\itememph{b} (if that's not clear to you, it will be after the discussion that follows).

But conversely, \cref{thm:properBaseChange} already follows from \cref{cor*:fuckUp} and \cref{cor:properBaseChange}! Indeed, to check whether the base change morphism is an isomorphism is a stalk-wise task. So let $\ov{s}'$ be a geometric point of $S'$ with image $f(\ov{s}')=\ov{s}$ in $S$. Put $X_{\ov{s}}=X\times_S\Spec \Oo_{S_\et,\ov{s}}$ and $X'_{\ov{s}'}=X'\times_{S'}\Spec \Oo_{S'_\et,\ov{s}'}$. Then \cref{cor:Rif_*Fy} shows
\begin{equation*}
	\big(f^*R^i p_*\Ff\big)_{\ov{s}'}\cong H^i\big(X_{\ov
	s,\et},\Ff\big)\quad\text{and}\quad \big(R^i p'_*g^*\Ff\big)_{\ov s'}\cong H^i\big(X'_{\ov{s}',\et},g^*\Ff\big)\,,
\end{equation*}
where we omit some $\pr_1^*$ to not overload the notation. Let $X_0$ and $X_0'$ be obtained from $X_{\ov{s}}$ and $X_{\ov{s}'}$ as in \cref{cor:properBaseChange}. Then
\begin{equation*}
	H^i\big(X_{\ov s,\et},\Ff\big)\cong H^i\big(X_{0,\et},\pr_1^*\Ff\big)\cong H^i\big(X'_{0,\et},\pr_1^*g^*\Ff\big)\cong H^i\big(X'_{\ov s',\et},g^*\Ff\big)\,,
\end{equation*}
where the middle isomorphism follows from \cref{cor*:fuckUp} and the outer ones follow from \cref{cor:properBaseChange}. This shows that \cref{thm:properBaseChange} indeed follows from its to corollaries. However, I don't see how \cref{cor:properBaseChange} alone would suffice, as was claimed in the lecture and by Deligne in \cite[Arcata~IV]{sga4.5}. In general, the extension $\kappa(\Oo_{S'_\et,\ov{s}'})/\kappa(\Oo_{S_\et,\ov{s}})$ of residue fields can be arbitrarily bad, and there's no reason why we could reduce to the case where the extension is finite or even just algebraic. So we need to work around this f*ck-up here. For that reason, some of the proofs are a bit different from the lecture.

Apart from that annoyance, our considerations above can be adapted if we impose one of the following additional restrictions.
\begin{numerate}
	\item To prove \cref{thm:properBaseChange} in the special case where the fibres of $p\colon X\morphism S$ have dimension $\leq 1$, it suffices to prove \cref{cor*:fuckUp} and \cref{cor:properBaseChange} in the corresponding special cases. This is particularly nice, because we already know \cref{cor*:fuckUp} in that situation (\cref{prop:CandCK} for dimension one; the zero-dimensional case is quite trivial).
	\item To prove \cref{thm:properBaseChange} in the special case where $p\colon X\morphism S$ is not only proper, but locally (on $S$) projective, it suffices to prove \cref{cor*:fuckUp} and \cref{cor:properBaseChange} in the corresponding special cases.
\end{numerate}
\end{rem}
\begin{rem*}\label{rem:fuckUp2}
	The upshot of \cref{rem:fuckUp} is that instead of \cref{cor*:fuckUp} and \cref{cor:properBaseChange}, it also suffices to prove the following single assertion, which somehow combines both:
	\begin{alphanumerate}
		\item[\itememph{\boxtimes}] \itshape Assume we are in the situation of \cref{cor:properBaseChange} and notation is as given there,  with the only exception that $\ov{s}\colon \Spec \kappa(\ov{s})\morphism S$ is an arbitrary geometric point over $k$ and $S_0=\Spec \kappa(\ov{s})$. Then the natural morphism
		\begin{equation*}
		H^i(X_\et,\Ff)\isomorphism H^i\big(X_{0,\et},\pr_1^*\Ff\big)\,.
		\end{equation*}
		is an isomorphism for all $i\geq 0$.\upshape
	\end{alphanumerate}
\end{rem*}
The first application of \itememph{\boxtimes} is to reduce everything to the noetherian case. Once we proved \cref{lem*:noetherianIsEnough} below, we will always assume we are in a noetherian situation without further mention.
\begin{lem*}\label{lem*:noetherianIsEnough}
	It suffices to prove \cref{thm:properBaseChange} in the special case where $S$ and $X$ are noetherian and $\Ff$ is a constructible sheaf on $X_\et$.
\end{lem*}
\begin{proof*}
	We first observe that if $(\Ff_\alpha)$ is a filtered system of sheaves on $X_\et$ such that \cref{thm:properBaseChange} holds for all $\Ff_\alpha$, then it also holds for $\Ff=\colimit \Ff_\alpha$. Indeed, it suffices to check \itememph{\boxtimes} above. Using that pullbacks commute with colimits and \cref{cor:cohoInverseLimit}, we see that we can pull out the colimit on both sides of $H^i(X_\et,\colimit \Ff)\morphism H^i(X_{0,\et},\colimit \pr_1^*\Ff_\alpha)$, and the claim follows immediately.
	
	In particular, we may assume that $\Ff$ is of the form
	\begin{equation*}
		\Ff\cong \coker\Bigg(\bigoplus_{l\in \LL} j_{l,!}\big(\IZ/M_l\IZ_{V_l}\big)\morphism[\phi] \bigoplus_{k\in \KK}i_{k,!}\big(\IZ/N_k\IZ_{U_k}\big)\Bigg)\,,
	\end{equation*}
	where $\KK$ and $\LL$ are finite indexing sets, $i_k\colon U_k\morphism X$ and $j_l\colon V_l\morphism X$ are étale morphisms, $N_k$ and $M_l$ are non-zero integers, and $\phi$ is any morphism of sheaves. Indeed, if we drop the condition that $\KK$ and $\LL$ be finite, every torsion sheaf can be written in that form. Thus, every torsion sheaf can be written as a cofiltered limit of sheaves of the above form, as required.
	
	To see that the noetherian constructible case suffices, it's again enough to check \itememph{\boxtimes}; moreover, we may assume that $\Ff$ is as above. Write $S=\limit S_\alpha$ as a cofiltered limit of spectra of noetherian strictly henselian rings. This is always possible: $A$ can be written as $\colimit T_\alpha$, where the colimit is taken over all finite type $\IZ$-subalgebras of $A$. Now let $\mm_\alpha\in \Spec T_\alpha$ be the preimage of the maximal ideal $\mm$ of $A$, and put $A_\alpha=(T_{\alpha})_{\mm_\alpha}^\sh$. Then $A_\alpha$ is strictly henselian and noetherian by \cref{prop:henselization}\itememph{e}, and $S=\limit \Spec A_\alpha$, as required. Using \itememph{i} and \itememph{j} from \cref{sec:inverseLimits}, we can write $p\colon X\morphism S$ as a simulatenous pullback and cofiltered limit of $p_\alpha\colon X_\alpha\morphism S_\alpha$ for sufficiently large $\alpha$. Moreover, $\Ff$ can be written as the pullback of some sheaf $\Ff_\alpha\in \cat{Ab}(X_{\alpha,\et})$, which has the same form as $\Ff$. This can be seen from the arguments in the proof of \cref{lem*:c1=>c2} (which is stated in a noetherian setting, but that's not used in the part of the proof we are interested in). In particular, $\Ff_\alpha$ is constructible by \cref{prop:constructible}\itememph{a}.
	
	Let $\Ff_\beta$ for $\beta\geq \alpha$ be the pullbacks of $\Ff_\alpha$ to $X_\beta$. Then \cref{prop:cohoInverseLimit} shows
	\begin{equation*}
		\colimit_{\beta\geq \alpha}H^i\big(X_{\beta,\et},\Ff_{\beta}\big)\cong H^i(X_\et,\Ff)\,.
	\end{equation*}
	Since $\ov{s}$ is a geometric point of ever $S_\beta$ as well, we can express $H^i(X_{0,\et},\pr_1^*\Ff)$ as a similar colimit. Thus \itememph{\boxtimes} reduces to the noetherian constructible case, as claimed.
\end{proof*}
\begin{lem}\label{lem:composition}
	Suppose we are given a commutative diagram
	\begin{equation*}
		\begin{tikzcd}
			Y'\rar["h"]\drar[pullback]\dar["q'"'] & Y\dar["q"]\\
			X'\rar["g"]\drar[pullback]\dar["p'"'] & X\dar["p"]\\
			S'\rar["f"] & S
		\end{tikzcd}
	\end{equation*}
	in which $S$, $X$, and $Y$ are noetherian, and $p$, $q$ are proper. If \cref{thm:properBaseChange} holds for $p$ and $q$, then it holds for $p\circ q$ as well.
\end{lem}
\begin{proof*}[Sketch of a proof]
	Professor Franke's intent was to use \cref{cor:properBaseChange} and \cref{rem:baseChangeSpecialCases}\itememph{a} to avoid a messy Leray spectral sequence argument, but his proof is flawed as pointed out in \cref{rem:fuckUp}. However, it turns out that the brute-force Leray approach is not too horrible either. By \cref{lem*:noetherianIsEnough}, we may assume that $\Ff$ is a constructible sheaf on $Y_\et$. Using \cref{prop:etaleLeray}, we get two spectral sequences
	\begin{equation*}
		E_2^{i,j}=f^*R^ip_*R^jq_*\Ff\converge f^*R^{i+j}(p\circ q)_*\Ff\,,\quad E_2^{i,j}=R^ip'_*R^jq'_*h^*\Ff\converge R^{i+j}(p'\circ q')_*h^*\Ff
	\end{equation*}
	(for the first one we use that $f^*$ is an exact functor). Since $\Ff$ is constructible, it is annihilated by some non-zero integer $N\neq 0$. Then $R^jq_*\Ff$ is annihilated by $N$ as well, and thus a torsion sheaf. Therefore, since \cref{thm:properBaseChange} holds for $p$ and $q$, we get
	\begin{equation*}
		f^*R^ip_*R^jq_*\Ff\cong R^ip'_*g^*R^jq_*\Ff\cong R^ip'_*R^jq'_*h^*\Ff\,.
	\end{equation*}
	Thus the $E_2$-pages of both spectral sequences are isomorphic (to be honest, we would have to check that their differentials agree as well; to verify this, you need to investigate functoriality properties of Cartan--Eilenberg resolutions, which I'm certainly not going to do here), proving that their limits coincide as well.
\end{proof*}
\begin{lem}\label{lem:dim0and1}
	Suppose $p\colon X\morphism S$ is a proper morphism of noetherian schemes such that $\dim X_{0}\leq 1$. Let $\Ff$ be a constant sheaf on $X_\et$ given by the finite abelian group $\Phi$. Then  \cref{cor:properBaseChange} holds in cohomological degrees $0$ and $1$, and in higher degrees one still gets a surjection
	\begin{equation*}
	H^i(X_\et,\Ff)\epimorphism H^i\big(X_{0,\et},\pr_1^*\Ff\big)
	\end{equation*}
	for all $i>1$.
\end{lem}
\begin{proof}
	Observe that the right-hand side vanishes for $i>2$ by \cref{prop:generalCurveVanishing}, so only the cases $i=0,1,2$ are interesting. As usual, we may assume that $\Phi=\IZ/\ell\IZ$ for some prime $\ell$, using induction and the long exact cohomology sequence. Recall that \cref{cor:pi1Proper} gave an equivalence of categories
	\begin{equation*}
		\left\{\text{finite étale $X$-schemes}\right\}\morphism \left\{\text{finite étale $X_0$-schemes}\right\}\,.
	\end{equation*}
	In particular, $\pi_0(X_0)\isomorphism \pi_0(X)$ is a bijection, and $\Global(X,\IZ/\ell\IZ)\cong \Global(X_0,\IZ/\ell\IZ)$ follows. Also we may assume that $X$ and $X_0$ are both connected. 
	
	For an arbitrary scheme $Y$ and any integer $N$, the cohomology group $H^1(Y_\et,\IZ/N\IZ)$ classifies $\IZ/N\IZ$-torsors on $Y_\et$ up to isomorphism (\cref{prop:TorsorsH1}). We claim that isomorphism classes of $\IZ/N\IZ$ torsors are in bijection with isomorphism classes of $\IZ/N\IZ$-principal bundles over $Y$ (see \cref{deflem:prinG}). Indeed, for $\Tt$ an $\IZ/N\IZ$-torsor, we choose an étale cover $\{V_i\morphism Y\}_{i\in I}$ over which $\Tt$ trivializes. Gluing the finite étale $V_i$-schemes $\IZ/N\IZ\times V_i$ according to $\Tt$ we obtain a finite étale $Y$-scheme $\snake{Y}$ via faithfully flat descent. By construction, $\snake{Y}$ is a $\IZ/N\IZ$-principal bundle. Conversely, given $\snake{Y}$, we can define $\Tt$ as follows: if $V\in Y_\et$, then $\Global(V,\Tt)$ is the set of sections of the morphism $\snake{Y}\times_YV\morphism V$, equipped with the $\IZ/N\IZ$-action coming from $\snake{Y}$. It's straightforward to check that these constructions are mutually inverse. In particular, if $Y$ is connected, then \cref{thm:GrothendieckGalois}\itememph{a} together with some easy arguments as in the proof of \cref{prop:Kummer} show that
	\begin{equation*}
		H^1(Y_\et,\IZ/N\IZ)\cong \Hom_{\mathrm{cont}}\big(\pi_1^\et(Y,\ov{y}),\IZ/N\IZ\big)
	\end{equation*}
	for an arbitrary base point $\ov{y}$. In our situation we have $\pi_1^\et(X_0,\ov{x})\cong \pi_1^\et(X,\ov{x})$ for any base point $\ov{x}$. Therefore the above considerations show that $H^1(X_\et,\IZ/\ell\IZ)\cong H^1(X_{0,\et},\IZ/\ell\IZ)$, as required.
	
	It remains to deal with the $i=2$ case. If $\ell=p>0$ is the characteristic of $k$, then we actually have $H^2(X_{0,\et},\IZ/p\IZ)=0$! Indeed, using \cref{par:algebraicClosure} we may check this after base change to $\ov{k}$, where we can apply \cref{rem*:Z/pZvanishing} (or rather the reference given there). So from now on, we assume that $\ell$ is invertible in $k$, and hence on all of $S$. The first step is to do a horribly messy reduction to the case where $k$ is algebraically closed. This was not done in the lecture, but it's necessary; otherwise the generic smoothness arguments later in the proof go wrong.
	
	Let $\Ii$ be the category of finite $A$-algebras $B$ such that $\Spec B\morphism \Spec A$ is a universal homeomorphism. Morphisms in $\Ii$ are given by local morphisms of local $A$-algebras (observe that every such $B$ is necessarily local because $\Spec B$ can have only one closed point). We claim:
	\begin{numerate}
		\item $\Ii$ is a filtered category.
		\item The colimit $\colimit_\Ii B=\ov{A}$ exists and is a strictly henselian local ring with residue field $\ov{k}$.
	\end{numerate}
	For \itememph{1}, observe that tensor products of objects in $\Ii$ are contained in $\Ii$ again for rather trivial reasons. Moreover, if $\alpha,\alpha'\colon B\morphism B'$ is a pair of parallel morphisms, then $\Coeq(\alpha,\alpha')$ is an element of $\Ii$ again. To see this, first observe that $\alpha$ and $\alpha'$ must induce the same map of underlying topological spaces between $\Spec B'$ and $\Spec B$. Moreover, let $\qq'\in \Spec B'$ with images $\qq\in \Spec B$ and $\pp\in \Spec A$. Then $\kappa(\qq)$ and $\kappa(\qq')$ are purely inseparable extensions of $\kappa(\pp)$, hence any morphism $\kappa(\qq)\morphism \kappa(\qq')$ is uniquely determined. This shows that $\Spec \Coeq(\alpha,\alpha')$ contains all points of $\Spec B'$, hence $\Spec \Coeq(\alpha,\alpha')\morphism \Spec A$ is a homeomorphism again. Moreover, $\Coeq(\alpha,\alpha')$ is clearly finite and radiciel over $A$ because the same must be true for $B'$ (see \cref{rem:universalHomeo}), proving $\Coeq(\alpha,\alpha')\in\Ii$.
	
	For \itememph{2}, observe that $\Ii$ is essentially small, hence the colimit exists. Being a colimit over local morphisms between local rings, $\ov{A}$ is local again. Using \cref{prop:henselian}\itememph{a}, we easily get that $\ov{A}$ is henselian again. It remains to show $\ov{A}/\ov{\mm}\cong \ov{k}$. It's clear that $\ov{A}/\ov{\mm}$ is algebraic over $k$. Conversely, every element of $\ov{k}$ is a $q\ordinalth$ root of some element $\ov{a}\in k$, where $q$ is a power of the characteristic $p$. Let $a\in A$ be a lift of $\ov{a}$ and let $B$ be obtained from $A$ by adjoining a $q\ordinalth$ root of $a$. Then $\Spec B\morphism \Spec A$ is finite, radiciel, and surjective on spectra, hence a universal homeomorphism by \cref{rem:universalHomeo}. This proves that $\ov{A}/\ov{\mm}$ contains all of $\ov{k}$.
	
	Now let $\ov{S}=\Spec \ov{A}$, put $\ov{X}=X\times_S\ov{S}$, and let $\ov{X}_0=\ov{X}\times_{\ov{S}}\Spec \ov{k}$ be the fibre over the closed point. Adapting the arguments from \cref{par:algebraicClosure}, we see that
	\begin{equation*}
		H^i(X_\et,\IZ/\ell\IZ)\cong H^i\big(\ov{X}_\et,\IZ/\ell\IZ\big)\quad\text{and}\quad H^i\big(X_{0,\et},\IZ/\ell\IZ\big)\cong H^i\big(\ov{X}_{0,\et},\IZ/\ell\IZ\big)\,.
	\end{equation*}
	 This reduces our original situation to the case where the residue field is algebraically closed. There's only one problem: $\ov{A}$ might not be noetherian any more. We will see below how to deal with this.
	 
	 To compute cohomology with coefficients in $\IZ/\ell\IZ$, we do the usual trick and replace $\IZ/\ell\IZ$ by $\mu_{\ell}$, as done before e.g.\ in \cref{cor:cohoOfmu}. Since $\ell$ is invertible in $k$, hence in $\ov{A}$, we can use the standard short exact sequence to get a diagram
	 \begin{equation*}
	 	\begin{tikzcd}
		 	H^1\big(\ov{X}_\et,\Oo_{\ov{X}_\et}^\times\big)\dar[epi]\rar & H^2\big(\ov{X}_\et,\mu_\ell\big)\dar\rar & H^2\big(\ov{X}_\et,\Oo_{\ov{X}_\et}^\times\big)\dar\\
		 	H^1\big(\ov{X}_{0,\et},\Oo_{\ov{X}_{0,\et}}^\times\big)\rar & H^2\big(\ov{X}_{0,\et},\mu_\ell\big) \rar & 0
	 	\end{tikzcd}
	 \end{equation*}
	 with exact rows. Once we verify that the two implicit assertions in this diagram are true, it will follow immediately that $H^2(\ov{X}_\et,\mu_\ell)\morphism H^2(\ov{X}_{0,\et},\mu_\ell)$ is surjective, as claimed.
	 
	 To see that the left vertical arrow is surjective, we need to check that $\Pic(\ov{X})\epimorphism \Pic(\ov{X}_0)$ is surjective (see \cref{cor:H1Pic}). Unfortunately, this doesn't follow immediately from \cref{cor:PicEpi}, since $\ov{A}$ might not be noetherian. As a workaround, we write $\ov{X}\cong \limit_\Ii X_\alpha$ and $\ov{X}_0\cong \limit_\Ii X_{\alpha,0}$ according to the definition of $\ov{A}$. Using \itememph{e} from \cref{sec:inverseLimits}, we get that $\colimit_\Ii\Pic(X_\alpha)\epimorphism \Pic(\ov{X})$ is surjective (in fact, it is even an isomorphism). The same is true for $\colimit_\Ii\Pic(X_{\alpha,0})\epimorphism \Pic(\ov{X}_0)$. But we know that $\Pic(X_\alpha)\epimorphism\Pic(X_{\alpha,0})$ is surjective by \cref{cor:PicEpi}, and surjectivity behaves well under colimits, hence we are done.
	 
	 It remains to explain why there is a $0$ in the bottom right corner. If $\dim \ov{X}_0=0$, this is rather trivial. Now assume $\dim \ov{X}_0=1$. Observe that we may replace $\ov{X}$ and $\ov{X}_0$ by their reductions $\ov{X}^\red$ and $\ov{X}_0^\red$ because this doesn't affect the cohomology with coefficients in $\IZ/\ell\IZ$ by \cref{prop:thickeningEtaleEquivalence}, and neither does it affect surjectivity of $\Pic(\ov{X})\epimorphism \Pic(\ov{X}_0)$, see the proof of \cref{cor:PicEpi}. After reducing everything, we can thus apply the following general fact:
	 \begin{alphanumerate}
	 	\item[\itememph{*}] \itshape Let $C$ be a reduced curve over an algebraically closed field $k$. Then $H^i(C_\et,\Oo_C^\times)=0$ for all $i>1$.
	 \end{alphanumerate}
 	If $C$ is smooth, this follows directly from \cref{prop:CurveCohoOXtimes}. Now assume $C$ is only integral. Let $p\colon \snake{C}\morphism C$ be its normalization. Since $k$ is perfect, we can apply generic smoothness to see that $p$ is an isomorphism over some dense open $U\subseteq C$. Then $\Oo_{C_\et}^\times\morphism p_*\Oo_{\snake{C}_\et}^\times$ is an isomorphism over $U_\et$. Thus
 	\begin{equation*}
 		H^i\big(C_\et,\Oo_{C_\et}^\times\big)\cong H^i\big(C_\et,p_*\Oo_{\snake{C}_\et}^\times\big) \cong H^i\big(\snake{C}_\et,\Oo_{\snake{C},\et}^\times\big)= 0
 	\end{equation*}
 	The second isomorphism uses \cref{prop:Rifinite=0} and the first one follows from \cref{fact:genericCohomologyVanishing}\itememph{b}. \enquote{Oh, but why are $\Oo_{C_\et}^\times$ and $p_*\Oo_{\snake{C}_\et}^\times$ torsion sheaves?}, I hear you object, and you are totally right: they aren't, most likely. However, torsion was only needed in \cref{fact:genericCohomologyVanishing}\itememph{a}, to get $\Ff|_{U_\et}=0$ for some open dense subset $U\subseteq C$. Here we get this for free, so the argument works.
 	
 	The reduction from reduced curves to integral curves is similar: let $C_1,\dotsc,C_n$ be the irreducible components of $C$, equipped with their reduced closed subscheme structures, and $i_j\colon C_j\monomorphism C$. Since $C$ is reduced, $\Oo_{C,\et}^\times\morphism \bigoplus_{j=1}^ni_{j,*}\Oo_{C_{j,\et}}^\times$ is an isomorphism over $U_\et$ for some dense open subset $U\subseteq C$ again, and we can apply the same argument once again.
\end{proof}
We would like to upgrade \cref{lem:dim0and1} to get a complete proof of \cref{cor:properBaseChange} in the special case $\dim X_0\leq 1$. It turns out that the only missing ingredient is a completely formal argument.
\begin{lem}\label{lem:formalLemma}
	Let $\Aa$ be an abelian category. Let $\XX\subseteq \Aa$ be a class of objects such that every $a\in \Aa$ admits a monomorphism $a\monomorphism x$ with $x\in \XX$. Let moreover $\Phi^\bullet,\Psi^\bullet\colon \Aa\morphism \cat{Ab}$ be cohomological functors such that $\Phi^\bullet$ is effaceable in the sense of \itememph{1} from \cref{prop:effaceable}\itememph{a}, and let $\phi^\bullet\colon \Phi^\bullet\morphism \Psi^\bullet$ be a natural transformation of cohomological functors. Then the following are equivalent:
	\begin{alphanumerate}
		\item $\phi^\bullet$ is an isomorphism.
		\item For all $x\in \XX$ and all $i\geq 0$, $\phi^i\colon \Phi^i(x)\epimorphism \Psi^i(x)$ is surjective, and bijective if $i=0$.
	\end{alphanumerate}
\end{lem}
\begin{proof*}
	This is an \enquote{amusing exercise}. See \cite[Arcata~IV Lem.\:3.6]{sga4.5}---where they also say \enquote{amusing exercise}, haha lol \Walley{}. Nevermind then, here's a proof.
	
	Suppose \itememph{b} holds. We prove that $\phi^i\colon \Phi^i(a)\epimorphism \Psi^i(a)$ is bijective using induction on $i$. Let $i=0$. By assumption on $\XX$, we find an exact sequence $0\morphism a\morphism x\morphism x''$. Since $\Phi^0$ and $\Psi^0$ are right-exact, we get a diagram
	\begin{equation*}
		\begin{tikzcd}
			0\rar & \Phi^0(a) \rar\dar["\phi^0"'] & \Phi^0(x)\rar\dar["\phi^0"',iso] & \Phi^0(x')\dar["\phi^0"',iso]\\
			0\rar & \Psi^0(a)\rar & \Psi^0(x)\rar & \Psi^0(x')
		\end{tikzcd}\,,
	\end{equation*}
	proving that $\phi^0\colon \Phi^0(a)\morphism \Psi^0(a)$ is an isomorphism too.
	
	Now let $i>0$ and the assertion be true for $i-1$. We first prove that $\phi^i$ is injective. Let $f\in \Phi^i(a)$ be in the kernel of $\phi^i$. Since $\Phi^\bullet$ is effaceable and $\XX$ has enough objects, we find a monomorphism $a\monomorphism x$ such that the image of $f$ in $\Phi^i(x)$ vanishes. Consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Phi^{i-1}(x)\rar\dar[iso, "\phi^{i-1}"']& \Phi^{i-1}(x/a)\rar\dar[iso, "\phi^{i-1}"'] & \Phi^i(a)\rar\dar["\phi^i"']& \Phi^i(x)\dar[epi, "\phi^i"']\rar& \Phi^i(x/a)\dar["\phi^i"']\\
			\Psi^{i-1}(x)\rar & \Psi^{i-1}(x/a)\rar & \Psi^i(a)\rar & \Psi^i(x) \rar & \Psi^i(x/a)
		\end{tikzcd}\,.
	\end{equation*}
	By exactness of the top row, $f$ is the image of some $f'\in \Phi^{i-1}(x/a)$. Let $g'\in \Psi^{i-1}(x/a)$ be the image of $f'$. Then the image of $g'$ in $\Psi^i(a)$ equals $\phi^i(f)=0$, hence $g'$ is the image of some $g''\in \Psi^{i-1}(x)$ by exactness of the bottom row. Using that the first and the second vertical arrows are isomorphisms by the induction hypothesis, we find that $g''=\phi^{i-1}(f'')$ for some $f''\in \Phi^{i-1}(x)$, and that $f$ is the image of $f''$ in $\Phi^i(a)$. But then $f=0$ by exactness, as required.
	
	To show bijectivity of $\phi^i$, we use the above diagram again. Now we know that the fourth vertical arrow is not only surjective, but bijective, and the fifth vertical arrow is injective. Thus, by the five lemma, $\phi^i$ must be bijective too. This finishes the induction.
\end{proof*}
\begin{lem}\label{lem:dimLeq1}
	\cref{cor:properBaseChange} holds in the special case where $\dim X_0\leq 1$. Thus, \cref{thm:properBaseChange} holds when all fibres of $p\colon X\morphism S$ have dimension $\leq 1$. In particular, it holds when $p$ is finite and for $X=\IP_S^1$.
\end{lem}
\begin{proof}
	Assume we are in the situation of \cref{cor:properBaseChange}, with $X$ and $S$ noetherian. Let $\Aa$ be the category of constructible sheaves on $X_\et$ and $\XX\subseteq \Aa$ the class of objects of the form $\bigoplus_{l=1}^np_{l,*}\Phi_l$, where $p_l\colon X_l\morphism X$ are finite morphisms and $\Phi_l$ are finite abelian groups. By characterization \itememph{c_2} from \cref{def:constructible}, every constructible sheaf admits a monomorphism into an object of $\XX$. Moreover, let $\Phi^\bullet=H^\bullet(X_\et,-)$ and $\Psi^\bullet=H^\bullet(X_{0,\et},\pr_1^*(-))$. Then $\Phi^\bullet$ and $\Psi^\bullet$ are cohomological functors $\Aa\morphism\cat{Set}$, and $\Phi^\bullet$ is effaceable by \cref{cor:constructibleEffaceable}. We claim that the natural transformation $H^\bullet(X_\et,-)\morphism H^\bullet(X_{0,\et},\pr_1^*(-))$ satisfies the condition from \cref{lem:formalLemma}\itememph{b} for the class $\XX$. Indeed, we have isomorphisms
	\begin{equation*}
		H^i\Bigg(X_\et,\bigoplus_{l=1}^np_{l,*}\Phi_l\Bigg)\cong \bigoplus_{l=1}^nH^i\big(X_{l,\et},\Phi_l\big)\,.
	\end{equation*}
	These follow from \cref{prop:Rifinite=0} and the Leray spectral sequence (\cref{prop:etaleLeray}). Now put $X_{l,0}\coloneqq X_l\times_SS_0$. By the same argument as before, plus \cref{fact*:finiteBaseChange}\itememph{a}, we get
	\begin{equation*}
	 H^i\Bigg(X_{0,\et},\pr_1^*\bigoplus_{l=1}^np_{l,*}\Phi_l\Bigg)\cong \bigoplus_{l=1}^nH^i\big(X_{l,0,\et},\pr_1^*\Phi_l\big)\,.
	\end{equation*}
	Using \cref{lem:dim0and1} on $X_l$ and $X_{l,0}$, we deduce that the condition from \cref{lem:formalLemma}\itememph{b} is indeed satisfied, and we get isomorphisms everywhere. In other words, \cref{cor:properBaseChange} holds for constructible sheaves in the special case where $S$ and $X$ are noetherian and $\dim X_0\leq 1$. Since \cref{cor*:fuckUp} holds in that special case too (\cref{prop:CandCK}), we conclude using \cref{rem:fuckUp} and \cref{lem*:noetherianIsEnough} that \cref{thm:properBaseChange} holds in full generality for morphisms whose fibres have dimension $\leq 1$.
\end{proof}
\begin{lem}\label{lem:PBCprojective}
	\cref{thm:properBaseChange} is true for all morphisms $p\colon X\morphism S$ of the form $X\monomorphism \IP_S^n\morphism S$, where the first arrow is a closed immersion.
\end{lem}
\begin{proof}[Sketch of a proof]
	By \cref{lem:dimLeq1}, \cref{thm:properBaseChange} holds when $p$ is a closed immersion, hence by \cref{lem:composition} it suffices to prove the assertion for $X=\IP_S^n$. We do induction on $n$. The case $n=1$ was done above, so let's assume $n>1$ and the assertion is true for $n-1$.
	
	Our construction follows \cite[Arcata~III.4]{sga4.5}. Let $u\colon Z\monomorphism \IP_S^n=\PROJ \Oo_S[t_0,\dotsc,t_n]$ be the closed embedding defined by the ideal $(t_0,t_1)$. Let $\pi\colon \snake{X}\morphism \IP_S^n$ be the blow-up of $Z$. The fibres of $\pi$ are isomorphic to $\IP^1$ over $Y$ and trivial everywhere else, hence \cref{thm:properBaseChange} holds for $\pi$ by \cref{lem:dimLeq1}. Moreover, there is a natural morphism $\IP_S^n\setminus Z\morphism \IP_S^1$ sending points $[x_0:\dotsb:x_n]$ to $[x_0:x_1]$ (yes, that's not really a definition; if you want to, work out how that looks as a morphism of schemes). It can be extended to a morphism $\snake{p}\colon \snake{X}\morphism \IP_S^1$. We thus obtain a diagram
	\begin{equation*}
		\begin{tikzcd}
			\snake{X}\dar["\snake{p}"',pos=0.57]\rar["\pi"] & \IP_S^n\dar["p"]\\
			\IP_S^1\rar &S
		\end{tikzcd}\,.
	\end{equation*}
	It can be shown that locally on $\IP_S^1$--more precisely, after restricting to the two copies of $\IA_S^1$ inside---the morphism $\snake{p}$ is isomorphic to $\pr_2\colon \IP_S^{n-1}\times_S\IA_S^1\morphism \IA_S^1$. Thus the induction hypothesis is applicable. Since \cref{thm:properBaseChange} is local on the base, this shows that the assertion is true for $\snake{p}$. By the above diagram and \cref{lem:composition} we conclude that \cref{thm:properBaseChange} is true for $p\circ \pi\colon \snake{X}\morphism S$. That is, if $\snake{g}\colon \snake{X}'\morphism\snake{X}$ denotes the base change of $g\colon X'\morphism X$ and $\pi'\colon \snake{X}'\morphism X'$ the base change of $\pi$, then
	\begin{equation*}
		f^*R^i(p\circ \pi)_*\snake{\Ff}\isomorphism R^i(p'\circ \pi')_*\snake{g}^*\snake{\Ff}
	\end{equation*}
	holds for all $i\geq 0$ and all torsion sheaves $\snake{\Ff}$ on $\snake{X}_\et$.
	
	Now let $\Ff$ be a constructible sheaf on $\IP_{S,\et}^n$. The classical approach to prove \cref{thm:properBaseChange} for $\Ff$ would be to look at $\Ff\morphism\pi_*\pi^*\Ff$, whose kernel and cokernel have support in $Z$ since $\pi$ is an isomorphism away from $Z$. An easy argument (see below) shows that \cref{thm:properBaseChange} thus holds for the kernel and the cokernel, so it suffices to prove it for $\pi_*\pi^*\Ff$ as well. This is where things get messy: one looks at the Leray spectral sequences converging to $f^*R^i(p\circ \pi)_*\pi^*\Ff$ and $R^i(p'\circ \pi')_*\snake{g}^*\pi^*\Ff$. Knowing that their limits coincide somehow provides information about their $E_2$-pages, which we are ultimately interested in.
	
	These arguments become way more cleaner when formulated in the framework of derived categories---which is why we introduced \cref{cor:derived}! We first claim:
	\begin{alphanumerate}
		\item[\itememph{*}] \itshape If $\snake{K}^\bullet\in D^+(\snake{X}_\et)$ is a bounded below complex with torsion cohomology, then \cref{cor:derived} holds for $p\colon X\morphism S$ if we plug in the complex $R\pi_*\snake{K}^\bullet$. The same is true for $Ru_*K^\bullet$ if $K^\bullet\in D^+(Z_\et)$ has torsion cohomology.
	\end{alphanumerate}
	To prove \itememph{*}, we calculate
	\begin{equation*}
		f^*Rp_*R\pi_*\snake{K}^\bullet \cong Rp'_*R\pi'_*\snake{g}^*\snake{K}^\bullet\cong Rp'_*g^*R\pi_*\snake{K}^\bullet\,.
	\end{equation*}
	The left isomorphism uses that \cref{cor:derived} holds for $(p\circ \pi)\colon \snake{X}\morphism S$ together with the \enquote{Leray spectral sequence} isomorphisms $Rp_*R\pi_*\cong R(p\circ \pi)_*$ and $Rp'_*R\pi'_*\cong R(p'\circ \pi')_*$. The right isomorphism uses that \cref{cor:derived} holds for $\pi\colon \snake{X}\morphism \IP_S^n$. This proves the claim about $R\pi_*\snake{K}^\bullet$. The claim about $Ru_*K^\bullet$ can be done in the exact same way, using that \cref{cor:derived} holds both for the closed embedding $u\colon Z\monomorphism \IP_S^n$ by \cref{lem:dimLeq1} and for $u\circ p\colon Z\morphism S$ by the induction hypothesis, as $Z\cong \IP_S^{n-2}$. We thus proved \itememph{*}.
	
	Given a constructible sheaf $\Ff$, consider the complex $C^\bullet\in D^+(X_\et)$ given by $\Ff$ placed in degree $-1$ and (any representative of) $R\pi_*$ placed in non-negative degrees. In formulas, $C^\bullet=(\Ff[-1]\morphism R\pi_*\pi^*\Ff)$, where the morphism between degrees $-1$ and $0$ is given by the canonical morphism $\Ff\morphism \pi_*\Ii^0$ for $\pi^*\Ff\morphism \Ii^\bullet$ any injective resolution. Observe that the cohomology sheaves $H^i(C^\bullet)$ have support contained in $Y$. Indeed, in degrees $i>0$ this follows from the fact that $R^i\pi_*\pi^*\Ff$ vanishes outside of $Z$ because $\pi$ is an isomorphism away from $Z$. In degrees $0$ and $-1$, we use the same argument for $\Ff\morphism \pi_*\pi^*\Ff$ which is an isomorphism away from $Y$. Therefore, $C^\bullet\cong Ru_*K^\bullet$ for some complex $K^\bullet\in D^+(Y_\et)$ with torsion cohomology; in fact, the canonical morphism $C^\bullet\morphism Ru_*u^*C^\bullet$ is a quasi-isomorphism (here we also use that $u_*$ is exact because of \cref{prop:Rifinite=0}).
	
	Finally, we have an obvious map of complexes $R\pi_*\pi^*\Ff\morphism C^\bullet$. Its mapping cone is quasi-isomorphic to $\Ff[-1]$ because, well, $R\pi_*\pi^*\Ff$ and $C^\bullet$ coincide except in degree $-1$. Thus, we obtain a distinguished triangle
	\begin{equation*}
		R\pi_*\pi^*\Ff\morphism C^\bullet\morphism \Ff[-1]\morphism R\pi_*\pi^*\Ff[1]
	\end{equation*}
	in $D^+(X_\et)$. Since \cref{cor:derived} holds for $R\pi_*\pi^*\Ff$ and $C^\bullet\cong Ru_*K^\bullet$ by \itememph{*}, this triangle shows that it holds for $\Ff[-1]$ as well, and thus for $\Ff$ too. 
\end{proof}
\begin{proof}[Proof of \cref{thm:properBaseChange}]
	The rest of the proof is basically another \enquote{dévissage} as in the proof of \cref{lem:PBCprojective}. Using \cref{lem*:noetherianIsEnough}, it suffices to deal with the case where $S$ and $X$ are noetherian. Moreover, the assertion is local with respect to $S$, whence we may assume that $S$ is affine (depending on your version of Chow's lemma this isn't even needed). By Chow's lemma, \cite[Théorème~(5.6.1)]{egaII}, we find a diagram
	\begin{equation*}
		\begin{tikzcd}
			X \drar["p"'] & \snake{X}\dar\lar["\pi"']\rar[mono] & \IP_S^n\dlar\\
			& S&
		\end{tikzcd}
	\end{equation*}
	in which $\pi$ is \enquote{projective} (in the EGA sense) and there exists a dense open subset $U\subseteq X$ such that $\pi^{-1}(U)\isomorphism U$ is an isomorphism. Locally on $X$, EGA-projective morphisms are of the form $\snake{X}\monomorphism \IP_X^m\morphism X$; depending on which version of Chow's lemma you want to use, you may even assume that $\pi$ has this form not only locally. In any case, \cref{cor:derived} holds for $\pi$.
	
	Let $Z=X\setminus U$, equipped with any closed subscheme structure, and denote $u\colon Z\monomorphism X$. By the principle of noetherian induction, we may assume that \cref{cor:derived} holds for $u\circ p\colon Z\morphism S$. Now, starting from \itememph{*}, the proof of \cref{lem:PBCprojective} can be copied verbatim.
\end{proof}

\section{Derived Direct Images with Compact Support}
\lecture[Nagata's compactification theorem. Derived direct images and cohomology with compact support. Cohomological dimension. Finiteness theorems.]{2020-01-31}
To start off todays lecture, we recall the famous \emph{Nagata compactification theorem}.
\begin{thm}\label{thm:Nagata}
	Let $f\colon X\morphism S$ be a separated\footnote{This was not mentioned in the lecture, but since proper morphisms and open embeddings are separated, it is clearly a necessary condition} morphism of finite type, and assume $S$ is quasi-compact and quasi-separated. Then there exists a factorization
	\begin{equation*}
		X\monomorphism[j]\ov{X}\morphism[\ov{f}]S\,,
	\end{equation*}
	in which $j$ is a quasi-compact\footnote{In the lecture we omitted the quasi-compactness condition, since we only worked in a noetherian setting.} open embedding and $\ov{f}$ is a proper morphism.
\end{thm}
While Nagata's original proof used the outdated language of varieties, the first scheme-theoretic proof was given by Lütkebohmert in \cite{LutkebohmertNagata}, using a different approach than Nagata. A translation of his original proof into scheme-theoretic language was given by Deligne \cite{DeligneNagata}. Vojta \cite{VojtaNagata} and Conrad \cite{ConradNagata} have written expositions of Deligne's proof. It should be mentioned that Conrad takes extra care to make the arguments work in the non-noetherian case as well. Finally, \cite[\stackstag{0F41}]{stacks-project} has another proof of the non-noetherian case.

\numpar{}
We would like to get a generalization of \cref{thm:properBaseChange} that drops the condition that $X$ be proper over $S$. This necessarily involves the higher derived direct images by some sort of \enquote{compactly supported cohomology}. We give a tentative definition: suppose $f\colon X\morphism S$ is separated and of finite type, and $S$ is quasi-compact and quasi-separated, so that $f$ admits a \defemph{compactification}, i.e., a factorization as in \cref{thm:Nagata}. If $\Ff$ is a torsion sheaf in $\cat{Ab}(X_\et)$, we put
\begin{equation*}
	R^if_!\Ff=R^i\ov{f}_*j_!\Ff
\end{equation*}
for all $i\geq 0$. Of course, it is not at all clear why $R^if_!\Ff$ should be independent of the choices of $j$ and $\ov{f}$, so that's the first thing to show.

\begin{defi}\label{def:compactification}
	Given $f\colon X\morphism S$ as above, we define a \defemph{category $\Cc$ of compactifications} of $f$ as follows: its objects are factorizations of $f$ as in \cref{thm:Nagata}. A \defemph{morphism of compactifications} is a commutative diagram
	\begin{equation*}
	\begin{tikzcd}
	& \ov{X}'\drar["\ov{f}'"]\dar["\pi"] & \\
	X\rar[mono, "j"] \urar[mono, "j'"] & \ov{X}\rar["\ov{f}"] & S
	\end{tikzcd}
	\end{equation*}
	such that $\pi^{-1}(\ov{X}\setminus X)=\ov{X}'\setminus X$.
\end{defi}
\begin{rem*}\label{rem*:scheme-theoreticallyDense}
	Actually, the additional condition in \cref{def:compactification} poses no real restriction: the morphism $\pi^{-1}(X)\morphism X$ is proper because it is a base change of $\pi$, and $j'\colon X\monomorphism \pi^{-1}(X)$ defines a section. But sections of separated morphisms are closed immersions, hence the open embedding $j'\colon X\monomorphism \pi^{-1}(X)$ must be the inclusion of an open-closed subscheme. In particular, it is an isomorphism as long as $X$ is scheme-theoretically dense in $\ov{X}'$. Of course this is not satisfied for all compactifications, but at least the class of compactifications with that property is cofinal in $\Cc$, because we can always replace $\ov{X}$ be the scheme theoretic image of $X$ in it (see \cite[\stackstag{01R8}]{stacks-project}).
\end{rem*}
\begin{rem*}\label{rem:cofiltered}
	To show that $R^if_!\Ff$ is independent of the choice of compactification (in the the best possible approximate sense of the word \enquote{independent}) it suffices to prove the following assertion (and I'm afraid Professor Franke didn't really make that point in the lecture).
	\begin{alphanumerate}
		\item[\itememph{\boxtimes}]\itshape Let $f\colon X\morphism S$ be separated of finite type and let $S$ be quasi-compact and quasi-separated. Then the category $\Cc$ from \cref{def:compactification} is cofiltered. Moreover, for any morphism $\pi$ in $\Cc$ and any torsion sheaf $\Ff\in \cat{Ab}(X_\et)$, there are isomorphisms
		\begin{equation*}
			\iota_\pi\colon R^i\ov{f}'_*j'_!\Ff\isomorphism R^i\ov{f}_*j_!\Ff
		\end{equation*}
		for all $i\geq 0$. These are natural in $\Ff$, assemble into an isomorphism of cohomological functors, and satisfy $\iota_{\pi\circ \pi'}=\iota_\pi\circ \iota_{\pi'}$.
	\end{alphanumerate}
	Once \itememph{\boxtimes} is proved, you could define $R^if_!\Ff=\limit_\Cc R^i\ov{f}_*j_!\Ff$, with transition morphisms provided by $\iota_\pi$, to obtain a definition that is truly independent of the choice of compactification (but we will usually omit that technical step).
	
	The main part of proving \itememph{\boxtimes} is done by \cref{lem:i_pi} and \cref{lem*:cofiltered} below
\end{rem*}
\begin{lem}\label{lem:i_pi}
	We obtain the following isomorphisms.
	\begin{alphanumerate}
		\item Consider a pullback diagram (we only need $\ov{p}^{-1}(\ov{X}\setminus X)=\ov{Y}\setminus Y$, but then the other conditions below imply that the diagram is cartesian)
		\begin{equation*}
			\begin{tikzcd}
				Y\rar[mono,"k"]\dar["p"']\drar[pullback] & \ov{Y}\dar["\ov{p}"]\\
				X\rar[mono, "j"]&\ov{X}
			\end{tikzcd}
		\end{equation*}
		in which $j$, $k$ are open embeddings and $\ov{p}$, $p$ are a proper morphism. For every torsion sheaf $\Ff$ on $Y_\et$ and all $i\geq 0$, there are unique isomorphisms
		\begin{equation*}
			j_!R^i p_*\Ff\isomorphism R^i\ov{p}_*k_!\Ff\,,
		\end{equation*}
		which are natural in $\Ff$, assemble into an isomorphism of cohomological functors, and fit, for $i=0$, into a commutative diagram
		\begin{equation*}
			\begin{tikzcd}
				j_!p_*\Ff\rar[iso]\dar[mono] & \ov{p}_*k_!\Ff\dar[mono]\\
				j_*p_*\Ff\rar[iso] & \ov{p}_*k_*\Ff
			\end{tikzcd}\,.
		\end{equation*}
		\item If $\pi$ is a morphism of compactifications as in \cref{def:compactification}, one has
		\begin{equation*}
			R^i\pi_*j'_!\Ff\cong \begin{cases*}
				j_!\Ff & if $i=0$\\
				0 & else
			\end{cases*}\,.
		\end{equation*}
	\end{alphanumerate}
\end{lem}
\begin{proof}
	Part~\itememph{a}. First recall that $j_!p_*\Ff$ and $\ov{p}_*k_!\Ff$ are subsheaves of $j_*p_*\Ff$ and $\ov{p}_*k_*\Ff$ in a canonical way; see \cref{rem*:j_!Fj_*F}. Thus, to get the desired commutative diagram, we must ensure that the bottom isomorphism identifies the subsheaves under consideration. They clearly coincide over the image of $X$ in $\ov{X}$. Thus it suffices to check whether they coincide on stalks at a geometric point $\ov{x}$ with image in $\ov{X}\setminus X$. Then clearly $(j_!p_*\Ff)_{\ov{x}}=0$ by the description of stalks in \cref{prop:j!}. To compute the stalk of $\ov{p}_*k_!\Ff$, we use \cref{cor:(f_*F)_y} and \cref{cor:properBaseChange} to get more generally
	\begin{equation*}
		\big(R^i\ov{p}_*k_!\Ff\big)_{\ov{x}}\cong H^i\big(Y_{\ov{x},\et},\pr_1^*k_!\Ff\big)\cong H^i\big(Y_{0,\et},\pr_1^*k_!\Ff\big)\,,
	\end{equation*}
	where $Y_{\ov{x}}=Y\times_X\Spec \Oo_{X_\et,\ov{x}}$ and $Y_0=Y\times_X\Spec \kappa(\ov{x})$. As $\ov{p}^{-1}(\ov{X}\setminus X)=\ov{Y}\setminus Y$, we see that the projection $\pr_1\colon Y_0\morphism Y$ has image inside $\ov{Y}\setminus Y$. Thus $\pr_1^*k_!\Ff=0$, and it's clear that $(\ov{p}_*k_!\Ff)_{\ov{x}}=0$ as well.
	
	To construct the required morphism $j_!R^i p_*\Ff\isomorphism R^i\ov{p}_*k_!\Ff$, first observe that both sides are cohomological functors by exactness of $j_!$ and $k_!$. In particular, it suffices to show that $j_!R^i p_*$ are the derived functors of $j_!p_*$. Clearly it will be enough to show that the functors $R^ip_*$ are effaceable for $i>0$ in the sense of \itememph{3} from \cref{prop:effaceable}\itememph{a}. This seems trivial on first glance, but there's a subtlety actually: we would like $R^ip_*$ to be effaceable \emph{when restricted to the full subcategory of torsion sheaves}! There are two ways to fix this.
	\begin{numerate}
		\item The natural transformation $j_!p_*\morphism \ov{p}_*k_!$ exists not only for torsion sheaves (but it might only be injective in general). The reason is that $(j_!p_*\Ff)_{\ov{x}}=0$ for $\ov{x}$ with image in $\ov{X}\setminus X$, so nothing can go wrong. In this case there's no trap and $R^ip_*$ is just effaceable.
		\item It is, in fact, true that $R^ip_*$ is effaceable on the category of torsion sheaves. The argument is similar to \cref{cor:constructibleEffaceable}. Using \cref{prop:technicalCech}, it's quite easy to check that $R^ip_*$ vanishes on $\prod_{\ov{x}}\ov{x}_*\Ff_{\ov{x}}$ for $i>0$. However, this sheaf might not be torsion since stalks of products are weird, unless $\Ff$ is annihilated by some integer $N\neq 0$. To fix this problem, write $\Ff=\colimit_{N\in \IN} \Ff[N]$ as a colimit over its $N$-torsion subsheaves, and consider
		\begin{equation*}
			\Ff\monomorphism \colimit_{n\in\IN}\prod_{\ov{x}}\ov{x}_*\Ff[N]_{\ov{x}}\,.
		\end{equation*}
		The sheaf on the right-hand side is torsion, and it can be shown that $R^ip_*$ vanishes on it, using \cref{cor:cohoInverseLimit}.
	\end{numerate}
	Either way, we get the desired uniquely determined morphism of cohomological functors. To see that it's an isomorphism, first observe that everything is clear over the image of $X$ in $\ov{X}$. Thus, it suffices to check that we get an isomorphism on stalks at $\ov{x}$ with image in $\ov{X}\setminus X$. In this case we have $(j_!R^ip_*\Ff)_{\ov{x}}=0=(R^i\ov{p}_*k_!\Ff)_{\ov{x}}$ by the above calculation.
	
	This finishes the proof of \itememph{a}. Part~\itememph{b} is an immediate consequence, because it is just the special case
	\begin{equation*}
		\begin{tikzcd}
			X\eqar[d]\rar[mono,"j'"] & \ov{X}'\dar["\pi"]\\
			X\rar[mono, "j"] & \ov{X}
		\end{tikzcd}\,.
	\end{equation*}
	We are done.
\end{proof}
\begin{lem*}\label{lem*:cofiltered}
	Let $S$ be quasi-compact quasi-separated, and $f\colon X\morphism S$ a separated morphism of finite type. Then the category $\Cc$ of compactifications of $f$, introduced in \cref{def:compactification}, is cofiltered.
\end{lem*}
\begin{proof}
	Although this lemma was not in the lecture, its proof was (at least partially). First observe that $\Cc$ is non-empty because of \cref{thm:Nagata}. There are two more conditions to check. For the reader's convenience, we first explain the constructions and prove their correctness afterwards, so you can skip these parts if you want.
	\begin{numerate}
		\item Let $\ov{f}\colon \ov{X}\morphism S$ and $\ov{f}'\colon \ov{X}'\morphism S$ be compactifications of $f$. We must construct a compactification $\ov{f}''\colon \ov{X}''\morphism S$ that \enquote{dominates both}, i.e., fits into a diagram
		\begin{equation*}
			\begin{tikzcd}
				 & \ov{X}'\drar["\ov{f}'"] & \\
				X\urar[mono,"j'"]\rar[mono,"j''"]\drar[mono,"j"] & \ov{X}''\uar["\pi'"']\dar["\pi"]\rar["\ov{f}"]& S\\
				& \ov{X}\urar["\ov{f}"'] &
			\end{tikzcd}
		\end{equation*}
		We can construct $\ov{X}''$ as the scheme-theoretic image of $(j,j')\colon X\morphism\ov{X}\times_S\ov{X}'$, i.e., the \enquote{smallest} closed subscheme over which $(j,j')$ factors (see \cite[\stackstag{01R5}]{stacks-project}). Then $\pi$ and $\pi'$ are induced by $\pr_1$ and $\pr_2$ respectively.
		\item Let $\pi,\pi'\colon \ov{X}'\morphism X$ be a pair of parallel morphism of compactifications. We must construct a compactification $\ov{f}''\colon \ov{X}''\morphism S$ together with a morphism $\pi''\colon \ov{X}''\morphism \ov{X}'$ such that $\pi\circ \pi''=\pi'\circ \pi''$. To get this, we simply take $\ov{X}''=\Eq(\pi,\pi')$, and $\pi''\colon \ov{X}''\morphism \ov{X}'$ is the canonical morphism.
	\end{numerate}
	We start proving that \itememph{1} works. The first step is to show that $j''\colon X\monomorphism\ov{X}''$ is a quasi-compact open embedding again. Since $j$ and $j'$ are quasi-compact and quasi-compactness is preserved under base change, $X\times_SX\monomorphism \ov{X}\times_SX$ and $\ov{X}\times_SX\monomorphism \ov{X}'$ are quasi-compact open immersions. Moreover, the diagonal  $\Delta\colon X\morphism X\times_SX$ is a closed immersion because $X$ is separated over $S$. Hence the composition $(j,j')\colon X\morphism\ov{X}\times_S\ov{X}'$ of these three morphisms is quasi-compact again, so $j''$ is quasi-compact as well. Now \cite[\stackstag{01R8}]{stacks-project} can be applied to see that $\ov{X}''\cap (X\times_SX)$ is the scheme-theoretic image of $\Delta$. Combining this with the fact that $\Delta$ is a closed immersion, hence an isomorphism onto its scheme-theoretic image, we get that $X$ is mapped isomorphically to the open subscheme $\ov{X}''\cap (X\times_SX)$ of $\ov{X}''$, so $j''\colon X\monomorphism\ov{X}''$ is indeed a quasi-compact open immersion. Since $\ov{X}''$ is a closed subscheme of the proper $S$-scheme $\ov{X}\times_S\ov{X}'$, we see that $\ov{f}''\colon\ov{X}''\morphism S$ is proper again, as required.
	
	For \itememph{2}, first observe that $\ov{X}''=\Eq(\pi,\pi')$ is a closed subscheme of $\ov{X}$ since $\ov{X}'$ is separated over $S$. Thus $\ov{f}''\colon\ov{X}''\morphism S$ is proper again. Moreover, since $\pi|_X=\pi'|_X=\id_X$, we see that the quasi-compact open embedding $j'\colon X\monomorphism \ov{X}'$ factors over $\ov{X}''$, hence we get $j''\colon X\monomorphism\ov{X}''$ as required.
\end{proof}
We are now ready to prove \itememph{\boxtimes} from \cref{rem:cofiltered}, which settles that $R^if_!\Ff$ is independent of the choice of compactification.
\begin{proof*}[Sketch of proof of \itememph{\boxtimes}]
	Cofilteredness of $\Cc$ was proved in \cref{lem*:cofiltered} above. To get the isomorphisms
	\begin{equation*}
		\iota_\pi\colon R^i\ov{f}'_*j'_!\Ff\isomorphism R^i\ov{f}_*j_!\Ff\,,
	\end{equation*}
	apply $R^i\ov{f}_*$ to \cref{lem:i_pi}\itememph{b} and use the Leray spectral sequence (\cref{prop:etaleLeray}), which conveniently collapses. We omit the verification that $\iota_{\pi\circ \pi'}=\iota_\pi\circ \iota_{\pi'}$.
\end{proof*}
\begin{defi}\label{def:f_!}
	Let $f\colon X\morphism S$ be a separated morphism of finite type between arbitrary schemes. Let further $\Ff$ be a torsion sheaf on $X_\et$.
	\begin{alphanumerate}
		\item The \defemph{$i\ordinalth$ higher direct image of $\Ff$ with compact support} is defined as follows: if $S$ is quasi-compact quasi-separated, let $\ov{f}\colon \ov{X}\morphism S$ be a Nagata compactification as in \cref{thm:Nagata}. Then put $R^if_!\Ff=R^i\ov{f}_*j_!\Ff$. In general, we cover $S$ by quasi-compact quasi-separated open subschemes, on which the above construction may be used, and glue everything together by means of the canonical isomorphisms from \itememph{\boxtimes}.
		\item If $S$ is the spectrum of a separably closed field, the \defemph{$i\ordinalth$ cohomology of $\Ff$ with compact support} is defined as $H_c^i(X_\et,\Ff)=H^i(\ov{X}_\et,j_!\Ff)$.
	\end{alphanumerate}
\end{defi}
\begin{prop}\label{prop:erBaseChange}
	Let $S$ be an arbitrary scheme.
	\begin{alphanumerate}
		\item Suppose $f\colon X\morphism Y$ and $g\colon Y\morphism S$ are separated morphisms of finite type, and $\Ff$ is a torsion sheaf in $\cat{Ab}(X_\et)$. Then there exists a Leray spectral sequence
		\begin{equation*}
			E_2^{p,q}=R^pg_!R^qf_!\Ff\converge R^{p+q}(g\circ f)_!\Ff
		\end{equation*}
		which is functorial in $\Ff$.
		\item Let $f\colon X\morphism S$ be separated of finite type. Let $j\colon U\monomorphism X$ be a quasi-compact\footnote{This condition was not in the lecture, since we only worked in a noetherian setting.} open embedding and $i\colon Z\monomorphism X$ be a closed embedding with image $X\setminus U$. Let $u=f\circ j\colon U\morphism S$ and $v=f\circ i\colon Z\morphism S$ denote the structure morphisms. For every torsion sheaf $\Ff$ in $\cat{Ab}(X_\et)$, there is a long exact \enquote{excision sequence}
		\begin{equation*}
			\dotso \morphism R^pu_!(\Ff|_{U_\et})\morphism R^pf_!\Ff\morphism R^pv_!(\Ff|_{Z_\et})\morphism R^{p+1}u_!(\Ff|_{U_\et})\morphism\dotso\,.
		\end{equation*}
		which is functorial in $\Ff$.
		\item Suppose we are given a pullback diagram
		\begin{equation*}
			\begin{tikzcd}
				X'\dar["f'"']\drar[pullback]\rar["g'"] & X\dar["f"]\\
				S'\rar["g"] & S
			\end{tikzcd}
		\end{equation*}
		in which $f$, $f'$ are separated morphisms of finite type, and $g$, $g'$ are arbitrary. Then for all $i\geq 0$ and all torsion sheaves $\Ff$ in $\cat{Ab}(X_\et)$, we get isomorphisms
		\begin{equation*}
			g^*R^if_!\Ff\isomorphism R^if'_!g'^*\Ff\,,
		\end{equation*}
		which are functorial in $\Ff$ and assemble into an isomorphism of cohomological functors. In particular, for any geometric point $\ov{s}$ of $S$ we get an isomorphism
		\begin{equation*}
			\big(R^if_!\Ff\big)_{\ov{s}}\cong H_c^i\big((X\times_S\Spec \kappa(\ov{s}))_\et,\pr_1^*\Ff\big)\,.
		\end{equation*}
	\end{alphanumerate}
\end{prop}
\begin{proof}
	All assertions are local on $S$, whence we may assume that $S$ is quasi-compact and quasi-separated throughout the proof. We start with \itememph{a}. Choose a compactification $\ov{g}\colon \ov{Y}\morphism S$ of $g$ according to \cref{thm:Nagata}. Our first goal is to construct a diagram
	\begin{equation*}
		\begin{tikzcd}
			X\rar[mono, "j"]\drar["f"'] & \ov{X}\rar[mono, "j'"]\dar["\ov{f}"']\drar[pullback] & \ov{X}'\dar["\ov{f}'"]\\
			& Y\rar[mono, "k"] & \ov{Y}
		\end{tikzcd}
	\end{equation*}
	in which the horizontal arrows are quasi-compact open embeddings as indicated, and $\ov{f}$, $\ov{f}'$ are proper. Applying \cref{thm:Nagata} to $g\circ f\colon X\morphism S$, we get a quasi-compact open embedding $j_0\colon X\monomorphism\ov{X}_0$ such that $\ov{X}_0$ is proper over $S$. Let $\ov{X}'$ be the scheme-theoretic image of $(j_0,k\circ f)\colon X\morphism \ov{X}_0\times_S\ov{Y}$. A slight generalization of our arguments in the proof of \cref{lem*:cofiltered} shows that we obtain a quasi-compact open embedding $j''\colon X\monomorphism \ov{X}'$. Moreover, the projection $\pr_2\colon \ov{X}_0\times_S\ov{Y}\morphism \ov{Y}$ induces a proper morphism $\ov{f}'\colon\ov{X}'\morphism \ov{Y}$. Let $\ov{X}=\ov{f}'^{-1}(Y)$ and let $j'\colon \ov{X}\monomorphism \ov{X}'$ and $\ov{f}\colon \ov{X}\morphism Y$ be the base changes of $k$ and $\ov{f}'$ respectively. We see that $\ov{f}$ is proper and $j''$ factors over $j'$, thus $j''=j'\circ j$ for some quasi-compact open embedding $j\colon X\monomorphism \ov{X}$. In particular, $\ov{f}$ is a compactification of $f\colon X\morphism Y$ and we obtain a diagram of the desired kind.
	
	Given the above diagram, part~\itememph{a} is a straightforward consequence of the Leray spectral sequence (\cref{prop:etaleLeray}). Consider
	\begin{equation*}
		E_2^{p,q}=R^p\ov{g}_*R^q\ov{f}_*(j'\circ j)_!\Ff\converge R^{p+q}(\ov{g}\circ \ov{f}')_*(j'\circ j)_!\Ff
	\end{equation*}
	Since $\ov{g}\circ \ov{f}'\colon \ov{X}'\morphism S$ is proper, the limit of the above spectral sequence is nothing else but $R^i(g\circ f)_!\Ff$ by \cref{def:f_!}\itememph{a}. To analyze its $E_2$-page,
	observe that $(j'\circ j)_!\cong j'_!\circ j_!$. Applying \cref{lem:i_pi}\itememph{a} to the pullback square in the above diagram thus gives
	\begin{equation*}
		E_2^{p,q}=R^p\ov{g}_*R^q\ov{f}_*(j'\circ j)_!\Ff\cong R^p\ov{g}_*k_!R^q\ov{f}_*j_!\Ff\cong R^pg_!R^qf_!\Ff\,,
	\end{equation*}
	where the isomorphism on the right-hand side follows straight from \cref{def:f_!}\itememph{a} and the fact that $\ov{f}$, $\ov{g}$ are compactifications of $f$, $g$ respectively. We thus obtain a spectral sequence of the desired kind.
	
	Part~\itememph{b}. Consider the short exact sequence $0\morphism j_!j^*\Ff\morphism \Ff\morphism i_*i^*\Ff\morphism 0$. Applying the cohomological functor $R^\bullet f_!$ to this sequence certainly produces some long exact sequence, and we only need to verify $R^pf_!j_!j^*\Ff\cong R^pu_!(\Ff|_{U_\et})$ and $R^pf_!i_*i^*\Ff\cong R^pv_!(\Ff|_{Z_\et})$. To see this, we use the spectral sequences from \itememph{a} applied to $u=f\circ j$ and $v=f\circ i$. In both cases it's easy to check that the spectral sequence collapses on its $E_2$-page, providing the desired isomorphisms (also see \cref{lem*:Rquasifinite_!}\itememph{c} below).
	
	Part~\itememph{c}. Since we may assume that $S$ is quasi-compact and quasi-separated, we can choose a Nagata-compactification of $f$ by \cref{thm:Nagata}. Base-changing everything to $S'$ thus provides a diagram
	\begin{equation*}
		\begin{tikzcd}
			X'\rar["g'"]\drar[pullback]\dar[mono,"j'"'] & X\dar[mono, "j"]\\
			\ov{X}'\rar["\ov{g}'"]\drar[pullback]\dar["\ov{f}'"'] & \ov{X}\dar["\ov{f}"]\\
			S'\rar["g"]&S
		\end{tikzcd}
	\end{equation*}
	Now the required base change isomorphism follows from the computation
	\begin{equation*}
		g^*R^if_!\Ff=g^*R^i\ov{f}_*j_!\Ff\cong R^i\ov{f}'_*\ov{g}'^*j_!\Ff\cong R^i\ov{f}'_*j'_!g'^*\Ff=Rf'_!g'^*\Ff\,.
	\end{equation*}
	The left isomorphism is just \cref{thm:properBaseChange}, and the right isomorphism follows from \cref{fact*:finiteBaseChange}\itememph{b}. The additional assertion about $(R^if_!\Ff)_{\ov{s}}$ is  the special case $S=\Spec \kappa(\ov{s})$.
\end{proof}
The following lemma didn't show up in the lecture (at least not in this form), but it should be mentioned once to be citeable later.
\begin{lem*}\label{lem*:Rquasifinite_!}
	Let $f\colon X\morphism S$ be a separated morphism of finite type and let $p\colon Y\morphism X$ be another morphism. Let $\Ff\in \cat{Ab}(Y_\et)$ be a torsion sheaf.
	\begin{alphanumerate}
		\item If $f$ is proper, then there's a functor isomorphism $R^if_!\isomorphism R^if_*$ for all $i\geq 0$.
		\item If $p$ is finite, then $R^if_!(p_*\Ff)\cong R^i(p\circ f)_!$ for all $i\geq 0$.
		\item If $p$ is quasi-finite and separated, then $R^ip_!\Ff=0$ for $i>0$.
	\end{alphanumerate}
\end{lem*}
\begin{proof*}
Part~\itememph{a} is trivial. For \itememph{b}, we apply \itememph{a} to the proper morphism $p$ and use \cref{prop:Rifinite=0} to see that the spectral sequence from \cref{prop:erBaseChange}\itememph{a} collapses. For \itememph{c}, everything is local on $S$, whence we may assume that $S$ is quasi-compact and quasi-separated. Applying Zariski's main theorem, we see that the Nagata compactification $\ov{p}\colon \ov{Y}\morphism X$ can be chosen such that $\ov{p}$ is finite. Then everything follows from \itememph{a} and \cref{prop:Rifinite=0}.
\end{proof*}
\begin{prop}
	Let $f\colon X\morphism S$ be a separated morphism of finite type and let $\Ff$ be a torsion sheaf in $\cat{Ab}(X_\et)$.
	\begin{alphanumerate}
		\item If $S=\Spec k$ is the spectrum of a separably closed field $k$, then $H_c^i(X_\et,\Ff)=0$ for all $i>2\dim X$.
		\item If $\ov{s}$ is a geometric point of $S$, then $(R^if_!\Ff)_{\ov{s}}=0$ for all $i>2\dim(X\times_S\Spec \kappa(\ov{s}))$.
	\end{alphanumerate}
\end{prop}
\begin{proof}
	Clearly \itememph{b} follows from \itememph{a} and \cref{prop:erBaseChange}\itememph{c}. In particular, \itememph{b} in the special case $X=\IA_S^1$ follows from \itememph{a} in the special case where $X$ is a curve over $k$. But we already know this special case because of \cref{prop:generalCurveVanishing}\itememph{b}---up to the slight subtlety that we need to choose $\ov{X}$ in \cref{def:f_!}\itememph{b} in such a way that it is again a curve over $k$! But that's no problem: in fact, it's always possible to choose $\ov{X}$ such that $X$ is scheme-theoretically dense in it; see \cref{rem*:scheme-theoreticallyDense}. The upshot is that \itememph{b} holds for $X=\IA_S^1$.
	
	In particular, if $\pi\colon \IA^d_k\morphism \IA_k^{d-1}$ denotes the canonical projection forgetting the last coordinate, then $R^q\pi_!\Ff=0$ for all $q>2$ and all torsion sheaves $\Ff$. We use this to prove that \itememph{a} holds in the special case $X=\IA_k^d$ via induction on $d$. The cases $d=0$ and $d=1$ are trivial resp.\ treated above. Now assume $d>1$ and the assertion is true for $d-1$. Then the spectral sequence
	\begin{equation*}
		E_2^{p,q}=H_c^p\big(\IA_{k,\et}^{d-1},R^q\pi_!\Ff\big)\converge H_c^{p+q}\big(\IA_{k,\et}^d,\Ff\big)
	\end{equation*}
	(this is a version of \cref{prop:erBaseChange}\itememph{a}, using that étale sheaves over a separably closed field are uniquely determined by their stalk at the only geometric point) satisfies $E_2^{p,q}=0$ whenever $p>2(d-1)$ or $q>2$, thus the limit $H^{p+q}(\IA_k^d,\Ff)$ vanishes whenever $p+q>2d$, as required. We will reduce the general case to the case of $X=\IA_k^d$.
	
	\emph{Step~1.} We reduce the assertion to the case where $X$ is affine. So suppose the affine case is known. Then the general case can be done using induction on the number of affine opens needed to cover $X$. Suppose that number is $n$. Write $X=U\cup X'$, where $U$ is affine and $X'$ can be covered by $n-1$ affine opens. Since intersections of affine opens are affine, using that $X$ is separated, we see that the induction hypothesis is applicable to $U'=U\cap X'$. Now everything follows from the following claim:
	\begin{alphanumerate}
		\item[\itememph{*}] \itshape In the situation of \itememph{a}, if $X=U\cup V$ is an open cover, then there exists a natural \enquote{Mayer--Vietoris sequence}
		\begin{equation*}
			\dotso\morphism H_c^p\big((U\cap V)_\et,\Ff)\morphism H^p(U_\et,\Ff)\oplus H^p(V_\et,\Ff)\morphism H^p(X_\et,\Ff)\morphism \dotso\,.
		\end{equation*}
		More generally, a similar sequence exists for arbitrary $X$, replacing cohomology with compact support $H_c^p(-,\Ff)$ by higher direct images with compact support $R^p(-)_!\Ff$.
	\end{alphanumerate}
	Claim~\itememph{*} is a formal consequence of the excision sequence from \cref{prop:erBaseChange}\itememph{b}, applying it twice to $Z=X\setminus U=V\setminus(U\cap V)$. The argument works just as in Algebraic Topology and is perhaps an amusing exercise if you don't know this already.
	
	\emph{Step~2.} So now let $X$ be affine. The next step is to reduce things to the case where $X$ is integral. This is done by the method that was used over and over again in \cref{sec:Constructible} and \cref{sec:CohoOfCurves}. As usual, \cref{prop:thickeningEtaleEquivalence} allows us to replace $X$ by its reduction $X^\red$. Now let $X_1,\dotsc,X_n$ be the irreducible components of $X$, equipped with their integral closed subscheme structures, and denote $i_j\colon X_j\monomorphism X$. Consider $\phi\colon \Ff\morphism \bigoplus_{j=1}^ni_{j,*}i_j^*\Ff$. \cref{lem*:Rquasifinite_!}\itememph{b} shows
	\begin{equation*}
		H_c^i\Bigg(X_\et,\bigoplus_{j=1}^ni_{j,*}i_j^*\Ff\Bigg)\cong \bigoplus_{j=1}^nH_c^i\big(X_{j,\et},i_j^*\Ff\big)\,.
	\end{equation*}
	In particular, if we assume the assertion is true in the affine integral case, then the right-hand side vanishes for $i>2\max \dim X_j=2\dim X$. Moreover, $\phi$ is an isomorphism over $U_\et$ for some dense open subset $U\subseteq X$. In particular, $\ker\phi$ and $\coker \phi$ are of the form $u_*\Kk$ and $u_*\Qq$, where $u\colon Z\monomorphism X$ is any closed subscheme with image $X\setminus U$, and $\Kk,\Qq\in \cat{Ab}(Z_\et)$. Since $\dim Z<\dim X$, we may use induction to assume that the assertion is true for $Z$ as well. Then \cref{lem*:Rquasifinite_!}\itememph{b} again shows
	\begin{equation*}
		H_c^i(X_\et,u_*\Kk)\cong H_c^i(Z_\et,\Kk)\quad\text{and}\quad H_c^i(X_\et,u_*\Qq)\cong H_c^i(Z_\et,\Qq)\,,
	\end{equation*}
	and the right-hand sides vanish for $i>2\dim Z$ by assumption. Writing down some long exact sequences finally shows $H_c^i(X_\et,\Ff)=0$ for $i>2\dim X$, as required.
	
	\emph{Step~3.} We deal with the case where $X$ is affine and integral, thus finishing the proof. By Noether normalization we find a finite morphism $p\colon X\morphism \IA_k^d$, where we necessarily have $d=\dim X$. Using \cref{lem*:Rquasifinite_!}\itememph{b} we get $H_c^i(X_\et,\Ff)\cong H_c^i(\IA_{k,\et}^d,p_*\Ff)=0$ for $i>2d$, as required.
\end{proof}
\section{Finiteness Theorems}
We finish the lecture with two finiteness results, which we don't have the time to prove. But who knows? Maybe we will come to that in Professor Franke's seminar next semester!
\begin{thm}
	Let $f\colon C\morphism S$ be a proper smooth relative curve and $n$ a positive integer which is invertible on $S$. Moreover, let $\mu_{n,C}$ and $\mu_{n,S}$ denote the sheaves of $n\ordinalth$ roots of unity on $C_\et$ and $S_\et$ respectively. Then we have isomorphisms
	\begin{equation*}
		R^if_*\mu_{n,C}\cong \begin{cases*}
			\mu_{n,S} & if $i=0$\\
			\JAC_{C/S}[n] & if $i=1$\\
			\IZ/n\IZ_S & if $i=2$\\
			0 & else
		\end{cases*}\,.
	\end{equation*}
\end{thm}
\begin{thm}
	If $f\colon X\morphism S$ is a separated morphism of finite type beween noetherian schemes, then for any constructible sheaf $\Ff\in\cat{Ab}(X_\et)$, the higher direct images with compact support $R^if_!\Ff$ are constructible again for all $i\geq 0$.
\end{thm}
\begin{cor}
	If $X$ is a separated scheme of finite type over a separably closed field $k$ and $\Ff\in \cat{Ab}(X_\et)$ is constructible, then the cohomology groups $H_c^i(X,\Ff)$ are finite abelian groups for all $i\geq 0$.
\end{cor}

\appendix
\include{./Chapters/EtaleIAppendix}


\backmatter\KOMAoption{chapterprefix}{false}
\printbibliography[prenote=LINKS]
\end{document}